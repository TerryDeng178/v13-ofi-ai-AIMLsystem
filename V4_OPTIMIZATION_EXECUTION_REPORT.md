# OFI/CVD v4 ä¿¡å·é‡æ„æ‰§è¡ŒæŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ¦‚è§ˆ

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2024-10-16  
**æ‰§è¡Œç‰ˆæœ¬**: v4.0 (ä¿¡å·é‡æ„ç‰ˆ)  
**æ‰§è¡Œä¾æ®**: `FINAL_V3_EXECUTION_REPORT.md` ä¼˜åŒ–å»ºè®®  
**æ‰§è¡Œç›®æ ‡**: å®ç°èƒœç‡è½¬æ­£ï¼Œè¾¾åˆ°åŸºç¡€äº¤æ˜“é¢‘ç‡  
**å®é™…ç»“æœ**: ä¿¡å·é‡æ„å®Œæˆï¼Œä½†èƒœç‡ä»ä¸º0%ï¼Œéœ€è¦è¿›ä¸€æ­¥æ·±åº¦åˆ†æ  

---

## âœ… v4 å®æ–½å®Œæˆæƒ…å†µ

### 1. ä¿¡å·é€»è¾‘é‡æ„ âœ…
**å®æ–½çŠ¶æ€**: å·²å®Œæˆ  
**ä¿®æ”¹æ–‡ä»¶**: `src/signals.py`  
**æ ¸å¿ƒæ”¹è¿›**:
- **é™ä½è¿ç»­ç¡®è®¤è¦æ±‚**: ä»2æ ¹æ”¹ä¸º1æ ¹ç¡®è®¤
- **å¢åŠ ä»·æ ¼åŠ¨é‡ç¡®è®¤**: å¼ºåŒ–ä»·æ ¼æ–¹å‘éªŒè¯
- **å¼•å…¥ä¿¡å·å¼ºåº¦è¯„åˆ†**: æ–°å¢`min_signal_strength`å‚æ•°
- **ç®€åŒ–åŠ¨é‡ä¿¡å·é€»è¾‘**: å•æ ¹ç¡®è®¤ + ä¿¡å·å¼ºåº¦ + ä»·æ ¼åŠ¨é‡

**ä»£ç å®ç°**:
```python
# Momentum: é™ä½è¿ç»­ç¡®è®¤è¦æ±‚ï¼Œä»2æ ¹æ”¹ä¸º1æ ¹ (v4 ä¿¡å·é‡æ„)
# å¢åŠ ä»·æ ¼åŠ¨é‡ç¡®è®¤
price_momentum_long = out["ret_1s"] > m.get("min_ret", 0.0)
price_momentum_short = out["ret_1s"] < -m.get("min_ret", 0.0)

# å¼•å…¥ä¿¡å·å¼ºåº¦è¯„åˆ†
signal_strength = (abs(out["ofi_z"]) + abs(out["cvd_z"])) / 2
min_signal_strength = m.get("min_signal_strength", 1.0)
strong_signal = signal_strength >= min_signal_strength

# ç®€åŒ–åŠ¨é‡ä¿¡å·é€»è¾‘ï¼šå•æ ¹ç¡®è®¤ + ä¿¡å·å¼ºåº¦ + ä»·æ ¼åŠ¨é‡
long_mask = (out["ofi_z"] >= m["ofi_z_min"]) & (out["cvd_z"] >= m["cvd_z_min"]) & price_momentum_long & strong_signal
short_mask = (out["ofi_z"] <= -m["ofi_z_min"]) & (out["cvd_z"] <= -m["cvd_z_min"]) & price_momentum_short & strong_signal
```

### 2. å¤§å¹…å‚æ•°è°ƒæ•´ âœ…
**å®æ–½çŠ¶æ€**: å·²å®Œæˆ  
**ä¿®æ”¹æ–‡ä»¶**: `config/params.yaml`  
**å‚æ•°è°ƒæ•´å¯¹æ¯”**:

| å‚æ•° | v3 å‡è¡¡ç‰ˆ | v4 ä¼˜åŒ–ç‰ˆ | å˜åŒ–å¹…åº¦ |
|------|-----------|-----------|----------|
| **ofi_z_min** | 2.1 | 1.0 | -52% |
| **cvd_z_min** | 1.4 | 0.6 | -57% |
| **min_signal_strength** | N/A | 1.5 | æ–°å¢ |
| **thin_book_spread_bps_max** | 1.4 | 2.5 | +79% |
| **k_ofi** | 0.10 | 0.20 | +100% |
| **size_max_usd** | 50000 | 80000 | +60% |
| **atr_stop_lo** | 1.1 | 0.6 | -45% |
| **atr_stop_hi** | 1.6 | 1.0 | -38% |
| **max_slippage_bps** | 7.0 | 12.0 | +71% |
| **session_window_minutes** | 15 | 30 | +100% |

### 3. å¤šç‰ˆæœ¬æµ‹è¯•é…ç½® âœ…
**å®æ–½çŠ¶æ€**: å·²å®Œæˆ  
**åˆ›å»ºæ–‡ä»¶**: 
- `config/params_v4_aggressive.yaml` (æ¿€è¿›ç‰ˆ)
- `config/params_v4_minimal.yaml` (æç®€ç‰ˆ)

---

## ğŸ“Š v4 æµ‹è¯•ç»“æœå¯¹æ¯”

### æµ‹è¯•é…ç½®å¯¹æ¯”è¡¨
| ç‰ˆæœ¬ | é…ç½®æ–‡ä»¶å | ofi_z_min | cvd_z_min | atr_stop_lo | äº¤æ˜“æ•° | èƒœç‡ | æ€»PnL |
|------|------------|-----------|-----------|-------------|--------|------|-------|
| **v4 ä¼˜åŒ–ç‰ˆ** | params.yaml | 1.0 | 0.6 | 0.6 | 57 | 0% | -$718.53 |
| **v4 æ¿€è¿›ç‰ˆ** | params_v4_aggressive.yaml | 0.7 | 0.4 | 0.4 | 93 | 0% | -$1,055.86 |
| **v4 æç®€ç‰ˆ** | params_v4_minimal.yaml | 0.5 | 0.3 | 0.3 | 141 | 0% | -$1,475.59 |

### æ€§èƒ½æŒ‡æ ‡è¯¦ç»†å¯¹æ¯”
| ç‰ˆæœ¬ | äº¤æ˜“æ•° | èƒœç‡ | æ€»PnL | å‡€PnL | å¤æ™®æ¯”ç‡ | æœ€å¤§å›æ’¤ | å¹³å‡æŒä»“æ—¶é—´ |
|------|--------|------|-------|-------|----------|----------|-------------|
| **v4 ä¼˜åŒ–ç‰ˆ** | 57 | 0% | -$718.53 | -$1,473.58 | -11,719 | -$712.39 | 6.4ç§’ |
| **v4 æ¿€è¿›ç‰ˆ** | 93 | 0% | -$1,055.86 | -$2,190.58 | -10,259 | -$1,045.73 | 6.7ç§’ |
| **v4 æç®€ç‰ˆ** | 141 | 0% | -$1,475.59 | -$2,943.79 | -8,864 | -$1,461.67 | 3.8ç§’ |

### æˆæœ¬åˆ†æå¯¹æ¯”
| ç‰ˆæœ¬ | æ€»æ‰‹ç»­è´¹ | æ‰‹ç»­è´¹å æ¯” | å¹³å‡æ‰‹ç»­è´¹/ç¬” | æˆæœ¬ä¼°è®¡ | å‡€äºæŸ |
|------|----------|------------|---------------|----------|--------|
| **v4 ä¼˜åŒ–ç‰ˆ** | $755.05 | 105% | $13.25 | $1,437.06 | -$1,473.58 |
| **v4 æ¿€è¿›ç‰ˆ** | $1,134.72 | 107% | $12.20 | $2,111.73 | -$2,190.58 |
| **v4 æç®€ç‰ˆ** | $1,468.20 | 100% | $10.41 | $2,951.18 | -$2,943.79 |

---

## ğŸ” æ·±åº¦é—®é¢˜åˆ†æ

### 1. æ ¸å¿ƒé—®é¢˜ï¼šèƒœç‡æŒç»­ä¸º0% ğŸ”´
**ç°è±¡**: æ‰€æœ‰v4ç‰ˆæœ¬èƒœç‡éƒ½ä¸º0%ï¼Œæ²¡æœ‰ä»»ä½•ç›ˆåˆ©äº¤æ˜“  
**æ ¹å› åˆ†æ**:
1. **ä¿¡å·è´¨é‡é—®é¢˜**: å³ä½¿å¤§å¹…é™ä½é˜ˆå€¼ï¼Œä¿¡å·è´¨é‡ä»ç„¶ä¸è¶³ä»¥äº§ç”Ÿç›ˆåˆ©
2. **æ•°æ®ç‰¹å¾é—®é¢˜**: åˆæˆæ•°æ®å¯èƒ½ä¸åæ˜ çœŸå®å¸‚åœºå¾®è§‚ç»“æ„
3. **æ­¢ç›ˆæ­¢æŸæ¯”ä¾‹**: å½“å‰1:1.67çš„æ¯”ä¾‹å¯èƒ½ä¸å¤Ÿè¦†ç›–æˆæœ¬
4. **å¸‚åœºç¯å¢ƒå‡è®¾**: ç­–ç•¥å¯èƒ½ä¸é€‚åˆå½“å‰æ•°æ®çš„æ—¶é—´æ®µç‰¹å¾

### 2. æ¬¡è¦é—®é¢˜åˆ†æ

#### é—®é¢˜1: äº¤æ˜“é¢‘ç‡æå‡ä½†è´¨é‡ä¸‹é™
- **v3**: 0-12ç¬”äº¤æ˜“
- **v4**: 57-141ç¬”äº¤æ˜“
- **åˆ†æ**: å‚æ•°æ”¾å®½æˆåŠŸå¢åŠ äº†äº¤æ˜“é¢‘ç‡ï¼Œä½†ä¿¡å·è´¨é‡æ²¡æœ‰æ”¹å–„

#### é—®é¢˜2: æŒä»“æ—¶é—´è¿‡çŸ­
- **v4 ä¼˜åŒ–ç‰ˆ**: å¹³å‡6.4ç§’
- **v4 æ¿€è¿›ç‰ˆ**: å¹³å‡6.7ç§’  
- **v4 æç®€ç‰ˆ**: å¹³å‡3.8ç§’
- **åˆ†æ**: æŒä»“æ—¶é—´è¿‡çŸ­ï¼Œæ— æ³•è·å¾—è¶³å¤Ÿçš„è¶‹åŠ¿æ”¶ç›Š

#### é—®é¢˜3: æˆæœ¬ç»“æ„ä»ç„¶ä¸åˆç†
- **æ‰‹ç»­è´¹å æ¯”**: 100-107%ï¼Œä»ç„¶è¶…è¿‡äºæŸé‡‘é¢
- **æˆæœ¬ä¼°è®¡**: ä¸å‡€äºæŸåŸºæœ¬ç›¸ç­‰
- **åˆ†æ**: äº¤æ˜“æˆæœ¬ä»ç„¶æ˜¯ä¸»è¦äºæŸæ¥æº

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### ç«‹å³è¡ŒåŠ¨å»ºè®® ğŸš€

#### 1. æ•°æ®è´¨é‡è¯Šæ–­
```python
# å»ºè®®çš„æ•°æ®åˆ†æè„šæœ¬
def analyze_data_quality(df):
    # 1. æ£€æŸ¥OFI/CVDçš„åˆ†å¸ƒç‰¹å¾
    print("OFI_zåˆ†å¸ƒ:", df["ofi_z"].describe())
    print("CVD_zåˆ†å¸ƒ:", df["cvd_z"].describe())
    
    # 2. æ£€æŸ¥ä¿¡å·ä¸åç»­æ”¶ç›Šçš„ç›¸å…³æ€§
    correlation = df["ofi_z"].corr(df["ret_1s"].shift(-1))
    print("OFIä¸æœªæ¥æ”¶ç›Šç›¸å…³æ€§:", correlation)
    
    # 3. æ£€æŸ¥ä»·æ ¼åŠ¨é‡çš„ä¸€è‡´æ€§
    momentum_consistency = (df["ofi_z"] * df["ret_1s"]).mean()
    print("åŠ¨é‡ä¸€è‡´æ€§:", momentum_consistency)
```

#### 2. æ­¢ç›ˆæ­¢æŸæ¯”ä¾‹ä¼˜åŒ–
```yaml
# å»ºè®®çš„æ­¢ç›ˆæ­¢æŸé…ç½®
risk:
  atr_stop_lo: 0.2               # æç´§æ­¢æŸ
  atr_stop_hi: 0.8               # 4:1ç›ˆäºæ¯”
  min_tick_sl_mult: 2            # æœ€å°tickæ­¢æŸ
```

#### 3. ä¿¡å·é€»è¾‘è¿›ä¸€æ­¥ç®€åŒ–
```python
# å»ºè®®çš„æç®€ä¿¡å·é€»è¾‘
def gen_signals_v5(df, params):
    # 1. ä»…ä½¿ç”¨OFIä¿¡å·ï¼Œå»æ‰CVDè¦æ±‚
    ofi_signal = abs(df["ofi_z"]) >= params["signals"]["momentum"]["ofi_z_min"]
    
    # 2. ä»…ä½¿ç”¨ä»·æ ¼åŠ¨é‡ç¡®è®¤
    price_momentum = abs(df["ret_1s"]) > 0.001  # 0.1%æœ€å°ä»·æ ¼å˜åŠ¨
    
    # 3. æç®€ç»„åˆ
    long_signal = (df["ofi_z"] > 0) & ofi_signal & (df["ret_1s"] > 0)
    short_signal = (df["ofi_z"] < 0) & ofi_signal & (df["ret_1s"] < 0)
    
    return long_signal, short_signal
```

### ä¸­æœŸä¼˜åŒ–å»ºè®® ğŸ“ˆ

#### 1. æœºå™¨å­¦ä¹ ä¿¡å·å¢å¼º
- ä½¿ç”¨XGBoostè®­ç»ƒä¿¡å·è´¨é‡åˆ†ç±»å™¨
- åŸºäºå†å²è¡¨ç°åŠ¨æ€è°ƒæ•´ä¿¡å·æƒé‡
- å¼•å…¥å¸‚åœºçŠ¶æ€è¯†åˆ«ï¼ˆè¶‹åŠ¿/éœ‡è¡/åè½¬ï¼‰

#### 2. å¤šæ—¶é—´æ¡†æ¶èåˆ
- 1ç§’ä¸»ä¿¡å· + 5ç§’ç¡®è®¤ + 15ç§’è¶‹åŠ¿è¿‡æ»¤
- ä¸åŒæ—¶é—´æ¡†æ¶çš„æƒé‡åŠ¨æ€è°ƒæ•´
- è·¨æ—¶é—´æ¡†æ¶çš„ä¿¡å·ä¸€è‡´æ€§æ£€æŸ¥

#### 3. åŠ¨æ€å‚æ•°è°ƒæ•´
- åŸºäºè¿‘æœŸèƒœç‡åŠ¨æ€è°ƒæ•´é˜ˆå€¼
- åŸºäºå¸‚åœºæ³¢åŠ¨ç‡è°ƒæ•´æ­¢ç›ˆæ­¢æŸ
- åŸºäºäº¤æ˜“é¢‘ç‡è°ƒæ•´ä»“ä½å¤§å°

---

## ğŸ“ˆ é¢„æœŸæ”¹è¿›æ•ˆæœ

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)
| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ä¼˜åŒ–ç›®æ ‡ | æ”¹å–„ç­–ç•¥ |
|------|----------|----------|----------|
| **èƒœç‡** | 0% | 15-25% | æç®€ä¿¡å·é€»è¾‘ + 4:1ç›ˆäºæ¯” |
| **äº¤æ˜“é¢‘ç‡** | 57-141ç¬” | 20-40ç¬” | æé«˜ä¿¡å·è´¨é‡é—¨æ§› |
| **æŒä»“æ—¶é—´** | 3-7ç§’ | 30-60ç§’ | æ”¾å®½æ­¢æŸï¼Œæ”¶ç´§æ­¢ç›ˆ |
| **æˆæœ¬å æ¯”** | 100%+ | <50% | æé«˜å•ç¬”ä»“ä½ï¼Œé™ä½é¢‘ç‡ |

### ä¸­æœŸç›®æ ‡ (1-2æœˆ)
| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ä¼˜åŒ–ç›®æ ‡ | æ”¹å–„ç­–ç•¥ |
|------|----------|----------|----------|
| **èƒœç‡** | 0% | 30-40% | MLä¿¡å·å¢å¼º + å¤šæ—¶é—´æ¡†æ¶ |
| **å¤æ™®æ¯”ç‡** | -8,000 | >0.5 | åŠ¨æ€å‚æ•°è°ƒæ•´ |
| **æœ€å¤§å›æ’¤** | -$1,400 | <$500 | é£é™©æ§åˆ¶ä¼˜åŒ– |
| **å¹´åŒ–æ”¶ç›Š** | è´Ÿå€¼ | 10-20% | å®Œæ•´ç­–ç•¥ä¼˜åŒ– |

---

## ğŸ† æ€»ç»“ä¸å»ºè®®

### æ‰§è¡Œæ€»ç»“

#### âœ… æˆåŠŸå®Œæˆçš„éƒ¨åˆ†
1. **ä¿¡å·é€»è¾‘é‡æ„**: æˆåŠŸé™ä½è¿ç»­ç¡®è®¤è¦æ±‚ï¼Œä»2æ ¹æ”¹ä¸º1æ ¹
2. **å‚æ•°å¤§å¹…è°ƒæ•´**: æ‰€æœ‰å…³é”®å‚æ•°éƒ½æŒ‰å»ºè®®è¿›è¡Œäº†è°ƒæ•´
3. **å¤šç‰ˆæœ¬æµ‹è¯•**: åˆ›å»ºäº†3ä¸ªä¸åŒä¸¥æ ¼åº¦çš„é…ç½®ç‰ˆæœ¬
4. **äº¤æ˜“é¢‘ç‡æå‡**: ä»0-12ç¬”æå‡åˆ°57-141ç¬”

#### âŒ ä»éœ€æ”¹è¿›çš„éƒ¨åˆ†
1. **èƒœç‡é—®é¢˜**: æ‰€æœ‰ç‰ˆæœ¬èƒœç‡ä»ä¸º0%ï¼Œéœ€è¦æ ¹æœ¬æ€§æ”¹è¿›
2. **ä¿¡å·è´¨é‡**: å³ä½¿å¤§å¹…æ”¾å®½å‚æ•°ï¼Œä¿¡å·è´¨é‡ä»ä¸è¶³
3. **æˆæœ¬æ§åˆ¶**: æ‰‹ç»­è´¹å æ¯”ä»ç„¶è¿‡é«˜
4. **æŒä»“æ—¶é—´**: æŒä»“æ—¶é—´è¿‡çŸ­ï¼Œæ— æ³•è·å¾—è¶‹åŠ¿æ”¶ç›Š

### å…³é”®å»ºè®®

#### ç«‹å³è¡ŒåŠ¨å»ºè®® ğŸš€
1. **æ•°æ®è´¨é‡è¯Šæ–­**: åˆ†æOFI/CVDä¸æœªæ¥æ”¶ç›Šçš„ç›¸å…³æ€§
2. **æç®€ä¿¡å·é€»è¾‘**: ä»…ä½¿ç”¨OFIä¿¡å·ï¼Œå»æ‰CVDè¦æ±‚
3. **æ­¢ç›ˆæ­¢æŸä¼˜åŒ–**: å®ç°4:1ç›ˆäºæ¯”ï¼Œæç´§æ­¢æŸ
4. **æˆæœ¬ç»“æ„ä¼˜åŒ–**: æé«˜å•ç¬”ä»“ä½ï¼Œé™ä½äº¤æ˜“é¢‘ç‡

#### ä¸­æœŸå‘å±•å»ºè®® ğŸ“ˆ
1. **æœºå™¨å­¦ä¹ é›†æˆ**: è®­ç»ƒä¿¡å·è´¨é‡åˆ†ç±»å™¨
2. **å¤šæ—¶é—´æ¡†æ¶**: å»ºç«‹è·¨æ—¶é—´æ¡†æ¶ç¡®è®¤æœºåˆ¶
3. **åŠ¨æ€å‚æ•°**: åŸºäºè¡¨ç°å®æ—¶è°ƒæ•´å‚æ•°
4. **å¸‚åœºçŠ¶æ€è¯†åˆ«**: åŒºåˆ†è¶‹åŠ¿/éœ‡è¡/åè½¬ç¯å¢ƒ

### é£é™©æç¤º âš ï¸

1. **æ•°æ®è´¨é‡é—®é¢˜**: åˆæˆæ•°æ®å¯èƒ½ä¸åæ˜ çœŸå®å¸‚åœºç‰¹å¾
2. **è¿‡æ‹Ÿåˆé£é™©**: è¿‡åº¦ä¼˜åŒ–å†å²æ•°æ®å­˜åœ¨è¿‡æ‹Ÿåˆé£é™©
3. **ä¿¡å·å¤±æ•ˆé£é™©**: å½“å‰ä¿¡å·é€»è¾‘å¯èƒ½æ ¹æœ¬æ€§ä¸é€‚åˆå¸‚åœº
4. **æˆæœ¬æ§åˆ¶é£é™©**: é«˜é¢‘äº¤æ˜“æˆæœ¬å¯èƒ½æ°¸è¿œæ— æ³•è¦†ç›–

### æœ€ç»ˆè¯„ä¼°

**å½“å‰ç³»ç»Ÿè¯„çº§**: C+ (ä¿¡å·é‡æ„å®Œæˆï¼Œä½†èƒœç‡ä»ä¸º0%)  
**ä¼˜åŒ–æ½œåŠ›è¯„çº§**: B (æœ‰æ”¹è¿›æ½œåŠ›ï¼Œä½†éœ€è¦æ ¹æœ¬æ€§æ”¹å˜)  
**æŠ•èµ„ä»·å€¼è¯„çº§**: C (å½“å‰æ— æŠ•èµ„ä»·å€¼ï¼Œéœ€è¦é‡å¤§æ”¹è¿›)  

**å»ºè®®æŠ•èµ„ç­–ç•¥**:
- **æš‚åœæŠ•èµ„**: å½“å‰ç­–ç•¥æ— ç›ˆåˆ©åŸºç¡€ï¼Œå»ºè®®æš‚åœèµ„é‡‘æŠ•å…¥
- **æ·±åº¦åˆ†æ**: ä¼˜å…ˆè¿›è¡Œæ•°æ®è´¨é‡å’Œä¿¡å·é€»è¾‘çš„æ·±åº¦åˆ†æ
- **åŸå‹éªŒè¯**: å¼€å‘æç®€åŸå‹éªŒè¯åŸºæœ¬å‡è®¾
- **é‡æ–°è®¾è®¡**: è€ƒè™‘é‡æ–°è®¾è®¡ä¿¡å·ç”Ÿæˆé€»è¾‘

---

**æ‰§è¡ŒçŠ¶æ€**: v4ä¿¡å·é‡æ„å®Œæˆï¼Œä½†èƒœç‡ä»ä¸º0%  
**ä¸‹ä¸€æ­¥**: æ•°æ®è´¨é‡è¯Šæ–­ + æç®€ä¿¡å·é€»è¾‘æµ‹è¯•  
**é¢„æœŸæ—¶é—´**: 2-4å‘¨å†…ç¡®å®šç­–ç•¥å¯è¡Œæ€§  
**æœ€ç»ˆç›®æ ‡**: æ‰¾åˆ°èƒ½äº§ç”Ÿæ­£èƒœç‡çš„ä¿¡å·é€»è¾‘  

*æœ¬æŠ¥å‘ŠåŸºäºv4ä¿¡å·é‡æ„çš„å®Œæ•´å®æ–½ï¼Œæ­ç¤ºäº†å½“å‰ç­–ç•¥çš„æ ¹æœ¬æ€§é—®é¢˜ï¼Œä¸ºåç»­ä¼˜åŒ–æä¾›æ˜ç¡®çš„æ”¹è¿›æ–¹å‘ã€‚*
