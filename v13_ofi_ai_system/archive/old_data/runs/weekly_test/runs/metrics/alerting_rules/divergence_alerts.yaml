groups:
- name: divergence_detection
  rules:
  - alert: DivergenceDetectionLatencyHigh
    annotations:
      description: 'P95检测延迟超过3ms: {{ $value }}s'
      summary: 背离检测延迟过高
    expr: histogram_quantile(0.95, rate(divergence_detection_latency_seconds_bucket[5m]))
      > 0.003
    for: 1m
    labels:
      severity: warning
  - alert: DivergenceEventsRateLow
    annotations:
      description: '过去1小时事件率: {{ $value }}/s'
      summary: 背离事件检测率过低
    expr: rate(divergence_events_total[1h]) < 0.1
    for: 5m
    labels:
      severity: info
  - alert: DivergenceScoreDistributionSkewed
    annotations:
      description: '中位数分数过低: {{ $value }}'
      summary: 背离分数分布偏斜
    expr: histogram_quantile(0.5, rate(divergence_score_bucket[1h])) < 50
    for: 10m
    labels:
      severity: warning
