# ğŸ¯ V13 OFI+AI é‡åŒ–äº¤æ˜“ç³»ç»Ÿ - å…¨æ–°å¼€å‘æŒ‡å¯¼

> **é‡æ–°å¼€å§‹åŸåˆ™**: ä»çœŸå®çš„æ ¸å¿ƒåŠŸèƒ½å¼€å§‹ï¼Œæ¯ä¸€æ­¥éƒ½æœ‰æ•°æ®éªŒè¯ï¼Œä¸åšå‡çš„ç»„ä»¶

---

## ğŸ“‹ **é¡¹ç›®æ¦‚è¿°**

### **é¡¹ç›®åç§°**: V13 OFI+AI é‡åŒ–äº¤æ˜“ç³»ç»Ÿï¼ˆå…¨æ–°é‡æ„ç‰ˆï¼‰
### **æ ¸å¿ƒç­–ç•¥**: Order Flow Imbalance (OFI) â†’ çœŸå®äº¤æ˜“ â†’ é€æ­¥åŠ å…¥AI
### **å¼€å‘åŸåˆ™**: 
- âœ… **çœŸå®ä¼˜å…ˆ**: æ¯ä¸ªåŠŸèƒ½éƒ½ç”¨çœŸå®æ•°æ®éªŒè¯
- âœ… **ç®€å•å¼€å§‹**: å…ˆåšä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå†æ‰©å±•
- âœ… **é€æ­¥è¿­ä»£**: æ¯ä¸ªé˜¶æ®µéƒ½èƒ½çœ‹åˆ°çœŸå®æ•ˆæœ
- âœ… **å…¨å±€æ€ç»´**: æ‰€æœ‰ç»„ä»¶å¿…é¡»ååŒå·¥ä½œï¼Œä¸åšå­¤ç«‹æ¨¡å—

---

## ğŸ¯ **V12é¡¹ç›®å›é¡¾ä¸æ•™è®­**

### **V12çš„æˆå°±** âœ…
1. å®Œæ•´çš„æŠ€æœ¯æ¶æ„è®¾è®¡ï¼ˆAIå±‚ã€ä¿¡å·å¤„ç†å±‚ã€æ‰§è¡Œå±‚ï¼‰
2. ä¸°å¯Œçš„ç»„ä»¶å¼€å‘ç»éªŒï¼ˆOFIè®¡ç®—ã€æ·±åº¦å­¦ä¹ æ¨¡å‹ã€ä¿¡å·èåˆï¼‰
3. å¤šæ¬¡å›æµ‹éªŒè¯ï¼ˆå‘ç°äº†å¾ˆå¤šé—®é¢˜ï¼‰
4. å†™å®æ•°æ®æ¡†æ¶ï¼ˆé¿å…æ•°æ®æ³„éœ²ï¼‰

### **V12çš„é—®é¢˜** âŒ
1. **å¾ˆå¤šç»„ä»¶æ˜¯"å‡çš„"** - åªæ˜¯ç®€å•çš„æ•°å­¦è®¡ç®—ï¼Œæ²¡æœ‰çœŸå®å®ç°
2. **Mockæ•°æ®è¿‡å¤š** - ç”¨æ¨¡æ‹Ÿæ•°æ®æ›¿ä»£çœŸå®å¸‚åœºæ•°æ®
3. **æ¥å£æ··ä¹±** - ç»„ä»¶ä¹‹é—´æ¥å£ä¸ç»Ÿä¸€ï¼Œéš¾ä»¥é›†æˆ
4. **è¿‡åº¦ä¼˜åŒ–** - åœ¨æ²¡æœ‰çœŸå®åŸºç¡€çš„æƒ…å†µä¸‹è¿½æ±‚æ€§èƒ½æŒ‡æ ‡
5. **ç¼ºä¹éªŒè¯** - æ²¡æœ‰ç”¨çœŸå®æ•°æ®éªŒè¯æ¯ä¸€æ­¥

### **å…³é”®æ•™è®­** ğŸ’¡
> **"ä¸è¦æ„å»ºçœ‹èµ·æ¥å®Œæ•´ä½†å®é™…ä¸Šæ˜¯å‡çš„ç³»ç»Ÿ"**
> 
> **"å…ˆåšå¥½ä¸€ä¸ªçœŸå®çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå†æ‰©å±•"**
> 
> **"æ¯ä¸€æ­¥éƒ½è¦æœ‰çœŸå®æ•°æ®éªŒè¯"**

---

## ğŸ—ï¸ **V13 å…¨æ–°å¼€å‘è·¯çº¿å›¾**

### **é˜¶æ®µ0: å‡†å¤‡å·¥ä½œï¼ˆ1å¤©ï¼‰** âœ… **å·²å®Œæˆ**

#### **ç›®æ ‡**: æ¸…ç†æ—§ä»£ç ï¼Œå»ºç«‹æ–°çš„å¼€å‘ç¯å¢ƒ

**ä»»åŠ¡æ¸…å•**:
- âœ… åˆ›å»ºæ–°çš„é¡¹ç›®ç›®å½• `v13_ofi_ai_system/`
- âœ… ä¿ç•™V12çš„æ¶æ„æ–‡æ¡£å’Œç»éªŒæ€»ç»“
- âœ… å½’æ¡£V12ä»£ç åˆ° `archive/v12/`
- âœ… å»ºç«‹æ–°çš„Gitä»“åº“æˆ–åˆ†æ”¯ `v13-fresh-start`
- âœ… å‡†å¤‡å¸å®‰APIå¯†é’¥ï¼ˆæµ‹è¯•ç½‘å’Œä¸»ç½‘ï¼‰
- âœ… **Task_0.6: åˆ›å»ºç»Ÿä¸€ç³»ç»Ÿé…ç½®æ–‡ä»¶**
- âœ… **Task_0.7: åŠ¨æ€æ¨¡å¼åˆ‡æ¢ä¸å·®å¼‚åŒ–é…ç½®**
- âœ… **Task_0.8: åˆ›å»ºGrafanaç›‘æ§ä»ªè¡¨ç›˜**

**Task_0.6 æˆæœ**:
- âœ… ç»Ÿä¸€é…ç½®ç³»ç»Ÿ (`config/system.yaml`)
- âœ… ç¯å¢ƒç‰¹å®šé…ç½® (`config/environments/`)
- âœ… é…ç½®åŠ è½½å™¨ (`src/utils/config_loader.py`)
- âœ… ç¯å¢ƒå˜é‡è¦†ç›–æ”¯æŒ
- âœ… é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†

**Task_0.7 æˆæœ**:
- âœ… åŠ¨æ€æ¨¡å¼åˆ‡æ¢æœºåˆ¶ (active/quietæ¨¡å¼)
- âœ… æ•°å­—èµ„äº§å¸‚åœºé€‚é… (24/7ã€HKTæ—¶åŒº)
- âœ… åŸå­çƒ­æ›´æ–° (RCUé”ä¿è¯ä¸€è‡´æ€§)
- âœ… 13ä¸ªPrometheusæŒ‡æ ‡ + ç»“æ„åŒ–æ—¥å¿—
- âœ… 6æ¡å‘Šè­¦è§„åˆ™ + 18ä¸ªå•å…ƒæµ‹è¯•
- âœ… è·¨åˆå¤œæ—¶é—´çª—å£æ”¯æŒ

**Task_0.8 æˆæœ**:
- âœ… 3ä¸ªGrafanaä»ªè¡¨ç›˜ (ç­–ç•¥æ¨¡å¼æ¦‚è§ˆã€æ€§èƒ½ç›‘æ§ã€å‘Šè­¦ç®¡ç†)
- âœ… å®Œæ•´çš„PrometheusæŒ‡æ ‡å¯è§†åŒ–
- âœ… æ—¶åŒºé…ç½® (Asia/Hong_Kong)
- âœ… å˜é‡é…ç½® ($env, $symbol)
- âœ… å‘Šè­¦è§„åˆ™é›†æˆ (4æ¡æ ¸å¿ƒå‘Šè­¦)
- âœ… å®Œæ•´çš„ç›‘æ§æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

**äº¤ä»˜ç‰©**:
```
v13_ofi_ai_system/
â”œâ”€â”€ README.md                    # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…ï¼ˆä»æœ€å°å¼€å§‹ï¼‰
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ binance_config.yaml     # å¸å®‰APIé…ç½®
â”‚   â”œâ”€â”€ system.yaml             # ç»Ÿä¸€ç³»ç»Ÿé…ç½®
â”‚   â””â”€â”€ environments/            # ç¯å¢ƒç‰¹å®šé…ç½®
â”œâ”€â”€ src/
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ config_loader.py    # é…ç½®åŠ è½½å™¨
â”‚       â””â”€â”€ strategy_mode_manager.py  # æ¨¡å¼ç®¡ç†å™¨
â”œâ”€â”€ grafana/
â”‚   â”œâ”€â”€ dashboards/             # 3ä¸ªç›‘æ§ä»ªè¡¨ç›˜
â”‚   â”œâ”€â”€ alerting_rules/         # å‘Šè­¦è§„åˆ™
â”‚   â””â”€â”€ provisioning/           # è‡ªåŠ¨é…ç½®
â”œâ”€â”€ tests/                      # æµ‹è¯•ä»£ç 
â”œâ”€â”€ data/                       # æ•°æ®å­˜å‚¨
â””â”€â”€ docs/
    â”œâ”€â”€ V13_DEVELOPMENT_GUIDE.md  # æœ¬æ–‡æ¡£
    â””â”€â”€ GRAFANA_DASHBOARD_GUIDE.md  # ç›‘æ§æŒ‡å—
```

---

### **é˜¶æ®µ1: çœŸå®OFI+CVDæ ¸å¿ƒï¼ˆ8-10å¤©ï¼‰** ğŸ”¥ **æœ€é‡è¦**

#### **ç›®æ ‡**: å®ç°çœŸæ­£çš„OFIå’ŒCVDè®¡ç®—ï¼Œä½¿ç”¨çœŸå®çš„å¸å®‰è®¢å•ç°¿å’Œæˆäº¤æ•°æ®

#### **1.1 å¸å®‰WebSocketæ•°æ®æ¥å…¥ï¼ˆ1å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/binance_websocket_client.py`
- [ ] è¿æ¥å¸å®‰WebSocketè®¢å•ç°¿æµ
- [ ] å®æ—¶æ¥æ”¶5æ¡£è®¢å•ç°¿æ•°æ®ï¼ˆbid1-5, ask1-5ï¼‰
- [ ] æ•°æ®å­˜å‚¨åˆ°æœ¬åœ°ï¼ˆCSVæˆ–æ•°æ®åº“ï¼‰
- [ ] å®æ—¶æ‰“å°è®¢å•ç°¿æ•°æ®ï¼Œç¡®è®¤æ•°æ®æœ‰æ•ˆæ€§

**éªŒè¯æ ‡å‡†**:
```python
# å¿…é¡»èƒ½çœ‹åˆ°çœŸå®çš„è®¢å•ç°¿æ•°æ®ï¼Œç±»ä¼¼ï¼š
{
    'timestamp': '2025-01-17 10:30:15.123',
    'symbol': 'ETHUSDT',
    'bids': [
        [3245.50, 10.5],  # [ä»·æ ¼, æ•°é‡]
        [3245.40, 8.3],
        [3245.30, 15.2],
        [3245.20, 12.1],
        [3245.10, 9.8]
    ],
    'asks': [
        [3245.60, 11.2],
        [3245.70, 9.5],
        [3245.80, 14.8],
        [3245.90, 10.3],
        [3246.00, 13.6]
    ]
}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… èƒ½è¿ç»­æ¥æ”¶1å°æ—¶ä»¥ä¸Šçš„è®¢å•ç°¿æ•°æ®
- âœ… æ•°æ®å®Œæ•´æ€§ >95%ï¼ˆæ— ç¼ºå¤±ï¼‰
- âœ… å»¶è¿Ÿ <500ms

**ä»£ç ç¤ºä¾‹**ï¼ˆå¿…é¡»çœŸå®å®ç°ï¼‰:
```python
# src/binance_websocket_client.py
import websocket
import json
from datetime import datetime

class BinanceOrderBookStream:
    def __init__(self, symbol='ethusdt'):
        self.symbol = symbol.lower()
        self.ws_url = f"wss://fstream.binance.com/ws/{self.symbol}@depth5@100ms"
        self.order_book_history = []
    
    def on_message(self, ws, message):
        """æ¥æ”¶è®¢å•ç°¿æ•°æ®"""
        data = json.loads(message)
        order_book = {
            'timestamp': datetime.fromtimestamp(data['E'] / 1000),
            'bids': [[float(p), float(q)] for p, q in data['b']],
            'asks': [[float(p), float(q)] for p, q in data['a']]
        }
        
        # å­˜å‚¨æ•°æ®
        self.order_book_history.append(order_book)
        
        # å®æ—¶æ‰“å°ï¼ˆéªŒè¯æ•°æ®ï¼‰
        print(f"[{order_book['timestamp']}] "
              f"Bid1: {order_book['bids'][0][0]:.2f} ({order_book['bids'][0][1]:.2f}) | "
              f"Ask1: {order_book['asks'][0][0]:.2f} ({order_book['asks'][0][1]:.2f})")
    
    def run(self):
        """å¯åŠ¨WebSocket"""
        ws = websocket.WebSocketApp(
            self.ws_url,
            on_message=self.on_message
        )
        ws.run_forever()
```

---

#### **1.2 çœŸå®OFIè®¡ç®—ï¼ˆ1-2å¤©ï¼‰**

**æ³¨æ„**: æ­¤é˜¶æ®µå®ŒæˆOFIè®¡ç®—åï¼Œå°†ç»§ç»­å®ç°CVDï¼ˆç´¯ç§¯æˆäº¤é‡å·®ï¼‰åŠŸèƒ½

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/real_ofi_calculator.py`
- [ ] å®ç°çœŸæ­£çš„å¤šæ¡£ä½OFIè®¡ç®—
- [ ] ä½¿ç”¨çœŸå®è®¢å•ç°¿æ•°æ®è®¡ç®—OFI
- [ ] è®¡ç®—OFIçš„Z-scoreæ ‡å‡†åŒ–
- [ ] å®æ—¶æ‰“å°OFIå€¼ï¼Œè§‚å¯Ÿå…¶å˜åŒ–

**OFIå…¬å¼ï¼ˆå¿…é¡»å‡†ç¡®å®ç°ï¼‰**:
```
OFI = Î£(i=1 to 5) w_i Ã— (Î”Bid_i Ã— I(Î”Bid_i > 0) - Î”Ask_i Ã— I(Î”Ask_i > 0))

å…¶ä¸­:
- w_i = æƒé‡ï¼ˆä¾‹å¦‚: [0.4, 0.25, 0.2, 0.1, 0.05]ï¼‰
- Î”Bid_i = å½“å‰ä¹°å•é‡ - ä¸Šä¸€ä¸ªä¹°å•é‡
- Î”Ask_i = å½“å‰å–å•é‡ - ä¸Šä¸€ä¸ªå–å•é‡
- I() = æŒ‡ç¤ºå‡½æ•°ï¼ˆå¤§äº0ä¸º1ï¼Œå¦åˆ™ä¸º0ï¼‰
```

**éªŒè¯æ ‡å‡†**:
```python
# å¿…é¡»èƒ½çœ‹åˆ°çœŸå®çš„OFIè®¡ç®—ç»“æœï¼Œç±»ä¼¼ï¼š
{
    'timestamp': '2025-01-17 10:30:15.123',
    'ofi_raw': 125.6,           # åŸå§‹OFIå€¼
    'ofi_z': 2.34,              # OFI Z-score
    'interpretation': 'STRONG_BUY'  # OFI > 2 è¡¨ç¤ºå¼ºä¹°å…¥
}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… OFIå€¼åœ¨åˆç†èŒƒå›´å†…ï¼ˆ-5 åˆ° +5ï¼‰
- âœ… OFI Z-scoreåˆ†å¸ƒæ¥è¿‘æ ‡å‡†æ­£æ€åˆ†å¸ƒ
- âœ… å¼ºOFIä¿¡å·ï¼ˆ|Z| > 2ï¼‰å‡ºç°é¢‘ç‡ 5-10%
- âœ… OFIèƒ½åæ˜ çœŸå®çš„è®¢å•æµå˜åŒ–

**ä»£ç ç¤ºä¾‹**ï¼ˆå¿…é¡»çœŸå®å®ç°ï¼‰:
```python
# src/real_ofi_calculator.py
import numpy as np
from collections import deque

class RealOFICalculator:
    def __init__(self, levels=5, window_size=1200):
        self.levels = levels
        self.weights = np.array([0.4, 0.25, 0.2, 0.1, 0.05])  # æ¡£ä½æƒé‡
        self.window_size = window_size  # Z-scoreè®¡ç®—çª—å£
        
        self.prev_bids = None
        self.prev_asks = None
        self.ofi_history = deque(maxlen=window_size)
    
    def calculate_ofi(self, bids, asks):
        """è®¡ç®—çœŸå®çš„OFI"""
        if self.prev_bids is None:
            self.prev_bids = bids
            self.prev_asks = asks
            return 0.0
        
        ofi = 0.0
        for i in range(self.levels):
            # ä¹°å•å˜åŒ–
            delta_bid = bids[i][1] - self.prev_bids[i][1]
            if delta_bid > 0:
                ofi += self.weights[i] * delta_bid
            
            # å–å•å˜åŒ–
            delta_ask = asks[i][1] - self.prev_asks[i][1]
            if delta_ask > 0:
                ofi -= self.weights[i] * delta_ask
        
        self.prev_bids = bids
        self.prev_asks = asks
        self.ofi_history.append(ofi)
        
        return ofi
    
    def get_ofi_zscore(self):
        """è®¡ç®—OFI Z-score"""
        if len(self.ofi_history) < 30:
            return 0.0
        
        ofi_array = np.array(self.ofi_history)
        mean = np.mean(ofi_array)
        std = np.std(ofi_array)
        
        if std < 1e-6:
            return 0.0
        
        current_ofi = self.ofi_history[-1]
        z_score = (current_ofi - mean) / std
        
        return z_score
```

---

#### **1.3 çœŸå®CVDè®¡ç®—ï¼ˆ2-3å¤©ï¼‰** ğŸ†•

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/real_cvd_calculator.py`
- [ ] åˆ›å»º `src/binance_trade_stream.py`
- [ ] è¿æ¥Binance WebSocketæˆäº¤æµ (`@aggTrade`)
- [ ] å®ç°CVDç´¯ç§¯è®¡ç®—
- [ ] è®¡ç®—CVDçš„Z-scoreæ ‡å‡†åŒ–
- [ ] å®æ—¶æ‰“å°CVDå€¼ï¼Œè§‚å¯Ÿå…¶å˜åŒ–

**CVDå…¬å¼ï¼ˆå¿…é¡»å‡†ç¡®å®ç°ï¼‰**:
```
CVD_t = CVD_{t-1} + Î”_t

å…¶ä¸­:
Î”_t = {
    +qty,  å¦‚æœæ˜¯ä¹°æ–¹ä¸»åŠ¨æˆäº¤ï¼ˆis_buyer_maker=Falseï¼‰
    -qty,  å¦‚æœæ˜¯å–æ–¹ä¸»åŠ¨æˆäº¤ï¼ˆis_buyer_maker=Trueï¼‰
}
```

**éªŒè¯æ ‡å‡†**:
```python
# å¿…é¡»èƒ½çœ‹åˆ°çœŸå®çš„CVDè®¡ç®—ç»“æœï¼Œç±»ä¼¼ï¼š
{
    'timestamp': '2025-10-17 10:30:15.123',
    'cvd_raw': 12345.67,        # ç´¯ç§¯æˆäº¤é‡å·®
    'cvd_delta': +10.5,         # æœ¬æ¬¡å˜åŒ–
    'direction': 'buy',         # ä¹°å…¥/å–å‡º
    'cvd_z': 1.23,              # CVD Z-score
    'ema_cvd': 12000.0          # EMAå¹³æ»‘å€¼
}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… CVDå€¼æ­£ç¡®ç´¯ç§¯
- âœ… æ–¹å‘åˆ¤æ–­å‡†ç¡®ï¼ˆä¹°æ–¹ä¸»åŠ¨ vs å–æ–¹ä¸»åŠ¨ï¼‰
- âœ… CVD Z-scoreåˆ†å¸ƒæ¥è¿‘æ ‡å‡†æ­£æ€åˆ†å¸ƒ
- âœ… å¼ºCVDä¿¡å·ï¼ˆ|Z| > 2ï¼‰å‡ºç°é¢‘ç‡ 5-10%

**ä»£ç ç¤ºä¾‹**ï¼ˆå¿…é¡»çœŸå®å®ç°ï¼‰:
```python
# src/real_cvd_calculator.py
from collections import deque
from dataclasses import dataclass
from typing import Optional, List

@dataclass
class CVDConfig:
    reset_period: Optional[int] = None  # CVDé‡ç½®å‘¨æœŸï¼ˆç§’ï¼‰ï¼ŒNone=ä¸é‡ç½®
    z_window: int = 300                 # z-scoreæ»šåŠ¨çª—å£
    ema_alpha: float = 0.2              # EMAå¹³æ»‘ç³»æ•°

class RealCVDCalculator:
    def __init__(self, symbol: str, cfg: CVDConfig = None):
        self.symbol = symbol
        self.cfg = cfg or CVDConfig()
        self.cumulative_delta = 0.0
        self.cvd_history = deque(maxlen=self.cfg.z_window)
        self.ema_cvd = None
    
    def update_with_trade(self, price: float, qty: float, 
                         is_buyer_maker: bool, event_time_ms: int):
        """
        æ›´æ–°CVDå€¼
        
        å‚æ•°:
            price: æˆäº¤ä»·æ ¼
            qty: æˆäº¤æ•°é‡
            is_buyer_maker: True=å–æ–¹ä¸»åŠ¨ï¼ŒFalse=ä¹°æ–¹ä¸»åŠ¨
            event_time_ms: äº‹ä»¶æ—¶é—´æˆ³
        """
        # åˆ¤æ–­æ–¹å‘
        if is_buyer_maker:
            # ä¹°æ–¹æŒ‚å•ï¼Œå–æ–¹åƒå• â†’ å–å‡ºå‹åŠ›
            delta = -qty
            direction = 'sell'
        else:
            # å–æ–¹æŒ‚å•ï¼Œä¹°æ–¹åƒå• â†’ ä¹°å…¥å‹åŠ›
            delta = +qty
            direction = 'buy'
        
        # ç´¯ç§¯
        self.cumulative_delta += delta
        self.cvd_history.append(self.cumulative_delta)
        
        # EMA
        if self.ema_cvd is None:
            self.ema_cvd = self.cumulative_delta
        else:
            alpha = self.cfg.ema_alpha
            self.ema_cvd = alpha * self.cumulative_delta + (1 - alpha) * self.ema_cvd
        
        return {
            'symbol': self.symbol,
            'event_time_ms': event_time_ms,
            'cvd': self.cumulative_delta,
            'cvd_delta': delta,
            'direction': direction,
            'z_cvd': self.get_cvd_zscore(),
            'ema_cvd': self.ema_cvd
        }
    
    def get_cvd_zscore(self):
        """è®¡ç®—CVD Z-score"""
        if len(self.cvd_history) < 30:
            return 0.0
        
        cvd_array = list(self.cvd_history)
        mean = sum(cvd_array) / len(cvd_array)
        variance = sum((x - mean) ** 2 for x in cvd_array) / len(cvd_array)
        std = variance ** 0.5
        
        if std < 1e-6:
            return 0.0
        
        current_cvd = self.cvd_history[-1]
        z_score = (current_cvd - mean) / std
        
        return z_score
```

**Binance Trade Stream è¿æ¥**:
```python
# src/binance_trade_stream.py
import websocket
import json
from datetime import datetime

class BinanceTradeStream:
    def __init__(self, symbol='ethusdt'):
        self.symbol = symbol.lower()
        self.ws_url = f"wss://fstream.binancefuture.com/stream?streams={self.symbol}@aggTrade"
        self.cvd_calculator = RealCVDCalculator(symbol.upper())
        self.trade_history = []
    
    def on_message(self, ws, message):
        """æ¥æ”¶æˆäº¤æ•°æ®"""
        data = json.loads(message)
        if 'data' in data:
            trade = data['data']
            
            # è®¡ç®—CVD
            result = self.cvd_calculator.update_with_trade(
                price=float(trade['p']),
                qty=float(trade['q']),
                is_buyer_maker=trade['m'],
                event_time_ms=trade['T']
            )
            
            # å­˜å‚¨æ•°æ®
            self.trade_history.append(result)
            
            # å®æ—¶æ‰“å°ï¼ˆéªŒè¯æ•°æ®ï¼‰
            print(f"[{datetime.fromtimestamp(trade['T']/1000)}] "
                  f"{result['direction'].upper()}: {result['cvd_delta']:+.2f} | "
                  f"CVD: {result['cvd']:.2f} | Z: {result['z_cvd']:.2f}")
    
    def run(self):
        """å¯åŠ¨WebSocket"""
        ws = websocket.WebSocketApp(
            self.ws_url,
            on_message=self.on_message
        )
        ws.run_forever()
```

---

#### **1.4 OFI+CVDèåˆæŒ‡æ ‡ï¼ˆ1å¤©ï¼‰** ğŸ†•

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/ofi_cvd_fusion.py`
- [ ] å®ç°OFIå’ŒCVDçš„èåˆç­–ç•¥
- [ ] å®ç°èƒŒç¦»æ£€æµ‹åŠŸèƒ½
- [ ] æµ‹è¯•èåˆæŒ‡æ ‡æ•ˆæœ

**èåˆç­–ç•¥**:
```python
# src/ofi_cvd_fusion.py
class OFI_CVD_Fusion:
    def __init__(self, w_ofi=0.6, w_cvd=0.4):
        """
        OFI+CVDèåˆæŒ‡æ ‡
        
        å‚æ•°:
            w_ofi: OFIæƒé‡ï¼ˆé»˜è®¤0.6ï¼‰
            w_cvd: CVDæƒé‡ï¼ˆé»˜è®¤0.4ï¼‰
        """
        self.w_ofi = w_ofi
        self.w_cvd = w_cvd
    
    def get_fusion_signal(self, z_ofi: float, z_cvd: float):
        """
        ç”Ÿæˆèåˆä¿¡å·
        
        è¿”å›:
            fusion_score: èåˆå¾—åˆ†
            signal: 'strong_buy' / 'buy' / 'neutral' / 'sell' / 'strong_sell'
            consistency: ä¿¡å·ä¸€è‡´æ€§ (0-1)
        """
        # åŠ æƒå¹³å‡
        fusion_score = self.w_ofi * z_ofi + self.w_cvd * z_cvd
        
        # ä¿¡å·ä¸€è‡´æ€§
        if z_ofi * z_cvd > 0:
            consistency = min(abs(z_ofi), abs(z_cvd)) / max(abs(z_ofi), abs(z_cvd))
        else:
            consistency = 0.0  # æ–¹å‘ä¸ä¸€è‡´
        
        # ç”Ÿæˆä¿¡å·
        if fusion_score > 2.5 and consistency > 0.7:
            signal = 'strong_buy'
        elif fusion_score > 1.5:
            signal = 'buy'
        elif fusion_score < -2.5 and consistency > 0.7:
            signal = 'strong_sell'
        elif fusion_score < -1.5:
            signal = 'sell'
        else:
            signal = 'neutral'
        
        return {
            'fusion_score': fusion_score,
            'signal': signal,
            'consistency': consistency,
            'ofi_weight': self.w_ofi,
            'cvd_weight': self.w_cvd
        }
    
    def detect_divergence(self, price: float, z_ofi: float, z_cvd: float, 
                          lookback_prices: list):
        """
        æ£€æµ‹OFI-CVDèƒŒç¦»
        
        è¿”å›:
            has_divergence: True/False
            divergence_type: 'bullish' / 'bearish' / 'inconsistent' / None
        """
        if len(lookback_prices) < 2:
            return {'has_divergence': False, 'divergence_type': None}
        
        # ä»·æ ¼è¶‹åŠ¿
        price_trend = price - lookback_prices[0]
        
        # æ­£å‘èƒŒç¦»ï¼ˆçœ‹æ¶¨ï¼‰
        if price_trend < 0 and z_ofi > 1 and z_cvd > 0.5:
            return {
                'has_divergence': True,
                'divergence_type': 'bullish',
                'strength': (abs(price_trend) * (z_ofi + z_cvd)) / 100
            }
        
        # è´Ÿå‘èƒŒç¦»ï¼ˆçœ‹è·Œï¼‰
        if price_trend > 0 and z_ofi < -1 and z_cvd < -0.5:
            return {
                'has_divergence': True,
                'divergence_type': 'bearish',
                'strength': (abs(price_trend) * abs(z_ofi + z_cvd)) / 100
            }
        
        # OFI-CVDä¸ä¸€è‡´
        if abs(z_ofi) > 2 and abs(z_cvd) > 1 and z_ofi * z_cvd < 0:
            return {
                'has_divergence': True,
                'divergence_type': 'inconsistent',
                'strength': abs(z_ofi - z_cvd)
            }
        
        return {'has_divergence': False, 'divergence_type': None}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… èåˆä¿¡å·é€»è¾‘æ¸…æ™°
- âœ… èƒŒç¦»æ£€æµ‹å‡†ç¡®
- âœ… å‚æ•°å¯è°ƒæ•´

---

#### **1.5 OFI+CVDä¿¡å·éªŒè¯ï¼ˆ1-2å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] æ”¶é›†1-3å¤©çš„çœŸå®OFI+CVDæ•°æ®
- [ ] åˆ†æOFIã€CVDã€èåˆæŒ‡æ ‡çš„æœ‰æ•ˆæ€§
- [ ] è§‚å¯ŸæŒ‡æ ‡ä¸ä»·æ ¼å˜åŠ¨çš„å…³ç³»
- [ ] åˆ†æèƒŒç¦»ä¿¡å·çš„é¢„æµ‹èƒ½åŠ›
- [ ] ç¡®å®šåˆç†çš„é˜ˆå€¼

**éªŒè¯æ–¹æ³•**:
```python
# tests/test_ofi_cvd_signal_validity.py
def test_ofi_cvd_predictive_power():
    """éªŒè¯OFI+CVDçš„é¢„æµ‹èƒ½åŠ›"""
    # 1. æ”¶é›†æ•°æ®
    ofi_data = load_historical_ofi_data('data/ofi_history.csv')
    cvd_data = load_historical_cvd_data('data/cvd_history.csv')
    fusion_data = load_fusion_data('data/fusion_history.csv')
    price_data = load_historical_price_data('data/price_history.csv')
    
    # 2. åˆ†æå„ç±»ä¿¡å·
    ofi_buy_signals = ofi_data[ofi_data['ofi_z'] > 2]
    cvd_buy_signals = cvd_data[cvd_data['cvd_z'] > 1]
    fusion_buy_signals = fusion_data[fusion_data['fusion_score'] > 2.5]
    divergence_signals = fusion_data[fusion_data['has_divergence'] == True]
    
    # 3. è®¡ç®—åç»­ä»·æ ¼å˜åŒ–
    ofi_returns = calculate_forward_returns(ofi_buy_signals, price_data, periods=[5, 10, 30])
    cvd_returns = calculate_forward_returns(cvd_buy_signals, price_data, periods=[5, 10, 30])
    fusion_returns = calculate_forward_returns(fusion_buy_signals, price_data, periods=[5, 10, 30])
    divergence_returns = calculate_forward_returns(divergence_signals, price_data, periods=[5, 10, 30])
    
    # 4. è¯„ä¼°é¢„æµ‹å‡†ç¡®æ€§
    ofi_accuracy = (ofi_returns > 0).mean()
    cvd_accuracy = (cvd_returns > 0).mean()
    fusion_accuracy = (fusion_returns > 0).mean()
    divergence_accuracy = (divergence_returns > 0).mean()
    
    print(f"OFIä¿¡å·å‡†ç¡®ç‡: {ofi_accuracy:.2%}")
    print(f"CVDä¿¡å·å‡†ç¡®ç‡: {cvd_accuracy:.2%}")
    print(f"èåˆä¿¡å·å‡†ç¡®ç‡: {fusion_accuracy:.2%}")
    print(f"èƒŒç¦»ä¿¡å·å‡†ç¡®ç‡: {divergence_accuracy:.2%}")
    
    # æˆåŠŸæ ‡å‡†
    assert ofi_accuracy > 0.55, "OFIä¿¡å·å‡†ç¡®ç‡ä¸è¶³"
    assert cvd_accuracy > 0.55, "CVDä¿¡å·å‡†ç¡®ç‡ä¸è¶³"
    assert fusion_accuracy > 0.60, "èåˆä¿¡å·å‡†ç¡®ç‡ä¸è¶³"
    assert divergence_accuracy > 0.55, "èƒŒç¦»ä¿¡å·å‡†ç¡®ç‡ä¸è¶³"
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… OFIä¿¡å·é¢„æµ‹å‡†ç¡®ç‡ > 55%
- âœ… CVDä¿¡å·é¢„æµ‹å‡†ç¡®ç‡ > 55%
- âœ… èåˆä¿¡å·é¢„æµ‹å‡†ç¡®ç‡ > 60%
- âœ… èƒŒç¦»ä¿¡å·é¢„æµ‹å‡†ç¡®ç‡ > 55%
- âœ… èåˆä¿¡å·æ•ˆæœä¼˜äºå•ä¸€æŒ‡æ ‡

**é˜¶æ®µ1äº¤ä»˜ç‰©**:
- âœ… èƒ½å®æ—¶æ¥æ”¶å¸å®‰è®¢å•ç°¿æ•°æ®ï¼ˆOrder Book Streamï¼‰
- âœ… èƒ½å®æ—¶æ¥æ”¶å¸å®‰æˆäº¤æ•°æ®ï¼ˆTrade Streamï¼‰
- âœ… èƒ½å®æ—¶è®¡ç®—çœŸå®çš„OFIå€¼
- âœ… èƒ½å®æ—¶è®¡ç®—çœŸå®çš„CVDå€¼
- âœ… èƒ½å®æ—¶ç”ŸæˆOFI+CVDèåˆä¿¡å·
- âœ… èƒ½æ£€æµ‹OFI-CVDèƒŒç¦»
- âœ… OFIã€CVDã€èåˆæŒ‡æ ‡ç»è¿‡éªŒè¯ï¼Œå…·æœ‰é¢„æµ‹èƒ½åŠ›
- âœ… 1-3å¤©çš„å†å²OFI+CVDæ•°æ®
- âœ… OFI+CVDä¿¡å·æœ‰æ•ˆæ€§åˆ†ææŠ¥å‘Š

---

### **é˜¶æ®µ2: ç®€å•ä½†çœŸå®çš„äº¤æ˜“ï¼ˆ2-3å¤©ï¼‰** ğŸ’°

#### **ç›®æ ‡**: åŸºäºOFIå®ç°ç®€å•äº¤æ˜“ç­–ç•¥ï¼Œåœ¨å¸å®‰æµ‹è¯•ç½‘æ‰§è¡ŒçœŸå®äº¤æ˜“

#### **2.1 å¸å®‰æµ‹è¯•ç½‘äº¤æ˜“æ¥å…¥ï¼ˆ1å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/binance_testnet_trader.py`
- [ ] è¿æ¥å¸å®‰æµ‹è¯•ç½‘API
- [ ] å®ç°ä¸‹å•ã€æ’¤å•ã€æŸ¥è¯¢åŠŸèƒ½
- [ ] æµ‹è¯•åŸºæœ¬äº¤æ˜“åŠŸèƒ½

**éªŒè¯æ ‡å‡†**:
```python
# å¿…é¡»èƒ½æ‰§è¡ŒçœŸå®çš„æµ‹è¯•ç½‘äº¤æ˜“
{
    'action': 'BUY',
    'symbol': 'ETHUSDT',
    'price': 3245.50,
    'quantity': 0.01,
    'order_id': '12345678',
    'status': 'FILLED',
    'executed_qty': 0.01,
    'executed_price': 3245.50
}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… èƒ½æˆåŠŸä¸‹å•å¹¶æˆäº¤
- âœ… èƒ½æŸ¥è¯¢è®¢å•çŠ¶æ€
- âœ… èƒ½æ’¤é”€æœªæˆäº¤è®¢å•
- âœ… äº¤æ˜“å»¶è¿Ÿ < 500ms

---

#### **2.2 ç®€å•OFIäº¤æ˜“ç­–ç•¥ï¼ˆ1å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/simple_ofi_strategy.py`
- [ ] å®ç°åŸºäºOFIçš„ç®€å•äº¤æ˜“é€»è¾‘
- [ ] æ·»åŠ åŸºæœ¬çš„é£é™©æ§åˆ¶
- [ ] è®¾ç½®æ­¢æŸå’Œæ­¢ç›ˆ

**ç­–ç•¥é€»è¾‘**ï¼ˆå¿…é¡»ç®€å•æ˜ç¡®ï¼‰:
```python
# src/simple_ofi_strategy.py
class SimpleOFIStrategy:
    def __init__(self, ofi_buy_threshold=2.0, ofi_sell_threshold=-2.0):
        self.ofi_buy_threshold = ofi_buy_threshold
        self.ofi_sell_threshold = ofi_sell_threshold
        self.position = 0  # 0=æ— ä»“ä½, 1=å¤šä»“, -1=ç©ºä»“
        self.entry_price = 0
        
        # é£é™©æ§åˆ¶
        self.stop_loss_pct = 0.01  # 1%æ­¢æŸ
        self.take_profit_pct = 0.02  # 2%æ­¢ç›ˆ
        self.max_position_size = 0.01  # ETH
    
    def generate_signal(self, ofi_z, current_price):
        """ç”Ÿæˆäº¤æ˜“ä¿¡å·"""
        # å¼€ä»“ä¿¡å·
        if self.position == 0:
            if ofi_z > self.ofi_buy_threshold:
                return 'BUY', self.max_position_size
            elif ofi_z < self.ofi_sell_threshold:
                return 'SELL', self.max_position_size
        
        # å¹³ä»“ä¿¡å·ï¼ˆæ­¢æŸ/æ­¢ç›ˆï¼‰
        elif self.position != 0:
            pnl_pct = (current_price - self.entry_price) / self.entry_price
            if self.position == 1:  # å¤šä»“
                if pnl_pct < -self.stop_loss_pct or pnl_pct > self.take_profit_pct:
                    return 'CLOSE_BUY', self.max_position_size
            elif self.position == -1:  # ç©ºä»“
                if pnl_pct > self.stop_loss_pct or pnl_pct < -self.take_profit_pct:
                    return 'CLOSE_SELL', self.max_position_size
        
        return 'HOLD', 0
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… ç­–ç•¥é€»è¾‘æ¸…æ™°ã€å¯éªŒè¯
- âœ… é£é™©æ§åˆ¶åˆ°ä½ï¼ˆæ­¢æŸã€æ­¢ç›ˆï¼‰
- âœ… èƒ½åœ¨æµ‹è¯•ç½‘æ‰§è¡ŒçœŸå®äº¤æ˜“

---

#### **2.3 çœŸå®äº¤æ˜“æµ‹è¯•ï¼ˆ1å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åœ¨å¸å®‰æµ‹è¯•ç½‘è¿è¡Œç­–ç•¥24å°æ—¶
- [ ] è®°å½•æ‰€æœ‰äº¤æ˜“è¯¦æƒ…
- [ ] è®¡ç®—çœŸå®çš„ç›ˆäº
- [ ] åˆ†æäº¤æ˜“è¡¨ç°

**éªŒè¯æ ‡å‡†**:
```python
# å¿…é¡»çœ‹åˆ°çœŸå®çš„äº¤æ˜“è®°å½•
{
    'date': '2025-01-17',
    'total_trades': 15,
    'winning_trades': 9,
    'losing_trades': 6,
    'win_rate': 60.0,
    'total_pnl': 12.50,  # USDT
    'total_return': 1.25,  # %
    'max_drawdown': -3.2,  # %
    'sharpe_ratio': 0.85
}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… èƒ½æ‰§è¡ŒçœŸå®äº¤æ˜“ï¼ˆä¸ç®¡ç›ˆäºï¼‰
- âœ… å®Œæ•´çš„äº¤æ˜“è®°å½•
- âœ… å‡†ç¡®çš„PnLè®¡ç®—
- âœ… ç³»ç»Ÿç¨³å®šè¿è¡Œ24å°æ—¶

**é˜¶æ®µ2äº¤ä»˜ç‰©**:
- âœ… èƒ½åœ¨æµ‹è¯•ç½‘æ‰§è¡ŒçœŸå®äº¤æ˜“
- âœ… åŸºäºOFIçš„ç®€å•äº¤æ˜“ç­–ç•¥
- âœ… 24å°æ—¶çœŸå®äº¤æ˜“è®°å½•
- âœ… äº¤æ˜“è¡¨ç°åˆ†ææŠ¥å‘Š

---

### **é˜¶æ®µ3: é€æ­¥åŠ å…¥AIï¼ˆ5-7å¤©ï¼‰** ğŸ§ 

#### **ç›®æ ‡**: åœ¨çœŸå®äº¤æ˜“åŸºç¡€ä¸Šï¼Œé€æ­¥åŠ å…¥AIæ¨¡å‹ä¼˜åŒ–

#### **3.1 æ•°æ®æ”¶é›†ä¸ç‰¹å¾å·¥ç¨‹ï¼ˆ2å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] æ”¶é›†çœŸå®äº¤æ˜“æ•°æ®ï¼ˆ1-2å‘¨ï¼‰
- [ ] æ ‡æ³¨äº¤æ˜“ç»“æœï¼ˆç›ˆåˆ©/äºæŸï¼‰
- [ ] æå–ç‰¹å¾ï¼ˆOFIã€æŠ€æœ¯æŒ‡æ ‡ã€å¸‚åœºçŠ¶æ€ï¼‰
- [ ] æ•°æ®æ¸…æ´—å’Œé¢„å¤„ç†

**ç‰¹å¾åˆ—è¡¨**ï¼ˆä»ç®€å•å¼€å§‹ï¼‰:
```python
features = {
    # OFIç›¸å…³ï¼ˆæ ¸å¿ƒï¼‰
    'ofi_z': float,           # OFI Z-score
    'ofi_momentum': float,    # OFIåŠ¨é‡
    'ofi_volatility': float,  # OFIæ³¢åŠ¨æ€§
    
    # CVDç›¸å…³ï¼ˆæ–°å¢ï¼‰
    'cvd_z': float,           # CVD Z-score
    'cvd_momentum': float,    # CVDåŠ¨é‡
    'cvd_rate': float,        # CVDå˜åŒ–ç‡
    
    # OFI-CVDèåˆï¼ˆæ–°å¢ï¼‰
    'fusion_score': float,    # èåˆå¾—åˆ†
    'signal_consistency': float,  # ä¿¡å·ä¸€è‡´æ€§
    'has_divergence': bool,   # æ˜¯å¦å­˜åœ¨èƒŒç¦»
    'divergence_type': str,   # èƒŒç¦»ç±»å‹
    
    # ä»·æ ¼ç›¸å…³
    'price_change': float,    # ä»·æ ¼å˜åŒ–
    'volatility': float,      # ä»·æ ¼æ³¢åŠ¨æ€§
    'rsi': float,            # RSIæŒ‡æ ‡
    
    # è®¢å•ç°¿ç›¸å…³
    'spread': float,         # ä¹°å–ä»·å·®
    'bid_depth': float,      # ä¹°å•æ·±åº¦
    'ask_depth': float,      # å–å•æ·±åº¦
    
    # å¸‚åœºçŠ¶æ€
    'volume': float,         # æˆäº¤é‡
    'time_of_day': int,      # æ—¶æ®µï¼ˆ0-23ï¼‰
}
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… è‡³å°‘1000æ¡æœ‰æ ‡æ³¨çš„äº¤æ˜“æ ·æœ¬
- âœ… ç‰¹å¾å®Œæ•´æ€§ > 95%
- âœ… æ•°æ®è´¨é‡éªŒè¯é€šè¿‡

---

#### **3.2 ç®€å•AIæ¨¡å‹è®­ç»ƒï¼ˆ2å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/simple_ai_model.py`
- [ ] ä½¿ç”¨RandomForestæˆ–XGBoost
- [ ] è®­ç»ƒä¿¡å·è´¨é‡é¢„æµ‹æ¨¡å‹
- [ ] è¯„ä¼°æ¨¡å‹æ€§èƒ½

**æ¨¡å‹è®¾è®¡**ï¼ˆä»ç®€å•å¼€å§‹ï¼‰:
```python
# src/simple_ai_model.py
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
import joblib

class SimpleAIModel:
    def __init__(self):
        self.model = RandomForestClassifier(
            n_estimators=100,
            max_depth=10,
            random_state=42
        )
    
    def train(self, features, labels):
        """è®­ç»ƒæ¨¡å‹"""
        X_train, X_test, y_train, y_test = train_test_split(
            features, labels, test_size=0.2, random_state=42
        )
        
        self.model.fit(X_train, y_train)
        
        # è¯„ä¼°
        train_score = self.model.score(X_train, y_train)
        test_score = self.model.score(X_test, y_test)
        
        print(f"è®­ç»ƒé›†å‡†ç¡®ç‡: {train_score:.2%}")
        print(f"æµ‹è¯•é›†å‡†ç¡®ç‡: {test_score:.2%}")
        
        return test_score
    
    def predict_signal_quality(self, features):
        """é¢„æµ‹ä¿¡å·è´¨é‡"""
        return self.model.predict_proba(features)[:, 1]  # ç›ˆåˆ©æ¦‚ç‡
    
    def save(self, path):
        """ä¿å­˜æ¨¡å‹"""
        joblib.dump(self.model, path)
    
    def load(self, path):
        """åŠ è½½æ¨¡å‹"""
        self.model = joblib.load(path)
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… æµ‹è¯•é›†å‡†ç¡®ç‡ > 55%
- âœ… æ¨¡å‹ä¸è¿‡æ‹Ÿåˆï¼ˆè®­ç»ƒé›†-æµ‹è¯•é›†å·®è· < 10%ï¼‰
- âœ… ç‰¹å¾é‡è¦æ€§åˆ†æåˆç†

---

#### **3.3 AIå¢å¼ºäº¤æ˜“ç­–ç•¥ï¼ˆ2-3å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/ai_enhanced_ofi_strategy.py`
- [ ] å°†AIæ¨¡å‹é›†æˆåˆ°äº¤æ˜“ç­–ç•¥
- [ ] ä½¿ç”¨AIè¿‡æ»¤ä½è´¨é‡ä¿¡å·
- [ ] åœ¨æµ‹è¯•ç½‘éªŒè¯æ•ˆæœ

**ç­–ç•¥é€»è¾‘**ï¼ˆAIå¢å¼ºï¼‰:
```python
# src/ai_enhanced_ofi_strategy.py
class AIEnhancedOFIStrategy(SimpleOFIStrategy):
    def __init__(self, ai_model, min_ai_confidence=0.6):
        super().__init__()
        self.ai_model = ai_model
        self.min_ai_confidence = min_ai_confidence
    
    def generate_signal(self, ofi_z, current_price, features):
        """AIå¢å¼ºçš„ä¿¡å·ç”Ÿæˆ"""
        # 1. åŸºç¡€OFIä¿¡å·
        base_signal, quantity = super().generate_signal(ofi_z, current_price)
        
        if base_signal in ['BUY', 'SELL']:
            # 2. AIè´¨é‡è¯„ä¼°
            ai_confidence = self.ai_model.predict_signal_quality(features)[0]
            
            # 3. AIè¿‡æ»¤
            if ai_confidence < self.min_ai_confidence:
                return 'HOLD', 0  # AIè®¤ä¸ºä¿¡å·è´¨é‡ä¸è¶³ï¼Œä¸äº¤æ˜“
            
            # 4. AIè°ƒæ•´ä»“ä½
            adjusted_quantity = quantity * ai_confidence
            return base_signal, adjusted_quantity
        
        return base_signal, quantity
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… AIèƒ½è¿‡æ»¤æ‰ä½è´¨é‡ä¿¡å·
- âœ… èƒœç‡æå‡ > 5%ï¼ˆç›¸æ¯”çº¯OFIç­–ç•¥ï¼‰
- âœ… æˆ–é£é™©è°ƒæ•´åæ”¶ç›Šæå‡ > 10%

**é˜¶æ®µ3äº¤ä»˜ç‰©**:
- âœ… 1000+æ¡æœ‰æ ‡æ³¨çš„çœŸå®äº¤æ˜“æ•°æ®
- âœ… è®­ç»ƒå¥½çš„AIæ¨¡å‹ï¼ˆå‡†ç¡®ç‡>55%ï¼‰
- âœ… AIå¢å¼ºçš„äº¤æ˜“ç­–ç•¥
- âœ… AIæ•ˆæœå¯¹æ¯”æµ‹è¯•æŠ¥å‘Š

---

### **é˜¶æ®µ4: æ·±åº¦å­¦ä¹ ä¼˜åŒ–ï¼ˆå¯é€‰ï¼Œ7-10å¤©ï¼‰** ğŸš€

#### **ç›®æ ‡**: åœ¨AIåŸºç¡€ä¸Šï¼ŒåŠ å…¥æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆLSTMã€Transformerï¼‰

**å‰ææ¡ä»¶**:
- âœ… é˜¶æ®µ3çš„ç®€å•AIæ¨¡å‹å·²ç»æœ‰æ•ˆ
- âœ… æœ‰è¶³å¤Ÿçš„è®­ç»ƒæ•°æ®ï¼ˆ>5000æ¡ï¼‰
- âœ… æœ‰æ˜ç¡®çš„æ€§èƒ½æå‡ç›®æ ‡

**è°¨æ…åŸåˆ™**:
> **åªæœ‰åœ¨ç®€å•AIæ¨¡å‹è¯æ˜æœ‰æ•ˆåï¼Œæ‰è€ƒè™‘æ·±åº¦å­¦ä¹ **
> 
> **æ·±åº¦å­¦ä¹ ä¸æ˜¯å¿…éœ€çš„ï¼Œç®€å•æ¨¡å‹å¯èƒ½å·²ç»è¶³å¤Ÿå¥½**

#### **4.1 LSTMæ—¶é—´åºåˆ—æ¨¡å‹ï¼ˆ3-4å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `src/lstm_ofi_model.py`
- [ ] è®¾è®¡LSTMç½‘ç»œæ¶æ„
- [ ] è®­ç»ƒæ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹
- [ ] å¯¹æ¯”ç®€å•AIæ¨¡å‹æ€§èƒ½

**æ¨¡å‹è®¾è®¡**:
```python
# src/lstm_ofi_model.py
import torch
import torch.nn as nn

class LSTMOFIModel(nn.Module):
    def __init__(self, input_size=12, hidden_size=64, num_layers=2):
        super().__init__()
        self.lstm = nn.LSTM(input_size, hidden_size, num_layers, batch_first=True)
        self.fc = nn.Linear(hidden_size, 2)  # äºŒåˆ†ç±»ï¼šç›ˆåˆ©/äºæŸ
    
    def forward(self, x):
        """å‰å‘ä¼ æ’­"""
        # x shape: (batch, seq_len, input_size)
        lstm_out, _ = self.lstm(x)
        # å–æœ€åä¸€ä¸ªæ—¶é—´æ­¥
        last_output = lstm_out[:, -1, :]
        out = self.fc(last_output)
        return out
```

**æˆåŠŸæŒ‡æ ‡**:
- âœ… æµ‹è¯•é›†å‡†ç¡®ç‡ > ç®€å•AIæ¨¡å‹ + 3%
- âœ… æˆ–ä¿æŒå‡†ç¡®ç‡ï¼Œä½†æå‡é²æ£’æ€§
- âœ… æ¨ç†å»¶è¿Ÿ < 50ms

---

#### **4.2 æ¨¡å‹å¯¹æ¯”ä¸é€‰æ‹©ï¼ˆ2-3å¤©ï¼‰**

**ä»»åŠ¡æ¸…å•**:
- [ ] A/Bæµ‹è¯•ï¼šç®€å•AI vs LSTM
- [ ] å¯¹æ¯”æ€§èƒ½æŒ‡æ ‡ï¼ˆå‡†ç¡®ç‡ã€é€Ÿåº¦ã€ç¨³å®šæ€§ï¼‰
- [ ] é€‰æ‹©æœ€ä¼˜æ¨¡å‹éƒ¨ç½²

**è¯„ä¼°æ¡†æ¶**:
```python
# tests/test_model_comparison.py
def compare_models():
    """å¯¹æ¯”ä¸åŒæ¨¡å‹çš„æ€§èƒ½"""
    models = {
        'simple_ai': SimpleAIModel(),
        'lstm': LSTMOFIModel(),
    }
    
    results = {}
    for name, model in models.items():
        # æµ‹è¯•æ€§èƒ½
        accuracy = test_accuracy(model, test_data)
        speed = test_inference_speed(model, test_data)
        stability = test_stability(model, test_data)
        
        # å®ç›˜æµ‹è¯•
        live_performance = run_live_test(model, duration_hours=24)
        
        results[name] = {
            'accuracy': accuracy,
            'speed': speed,
            'stability': stability,
            'live_win_rate': live_performance['win_rate'],
            'live_pnl': live_performance['total_pnl']
        }
    
    # é€‰æ‹©æœ€ä¼˜æ¨¡å‹
    best_model = select_best_model(results)
    print(f"æœ€ä¼˜æ¨¡å‹: {best_model}")
    
    return results
```

**é˜¶æ®µ4äº¤ä»˜ç‰©**:
- âœ… LSTMæ·±åº¦å­¦ä¹ æ¨¡å‹
- âœ… æ¨¡å‹å¯¹æ¯”æµ‹è¯•æŠ¥å‘Š
- âœ… æœ€ä¼˜æ¨¡å‹é€‰æ‹©æ–¹æ¡ˆ

---

## ğŸ“Š **å…³é”®æˆåŠŸæŒ‡æ ‡ï¼ˆKPIï¼‰**

### **é˜¶æ®µæ€§ç›®æ ‡**

| é˜¶æ®µ | æ—¶é—´ | å…³é”®æŒ‡æ ‡ | æˆåŠŸæ ‡å‡† |
|------|------|---------|---------|
| **é˜¶æ®µ1** | 8-10å¤© | OFIä¿¡å·å‡†ç¡®ç‡ | >55% |
| **é˜¶æ®µ1** | 8-10å¤© | CVDä¿¡å·å‡†ç¡®ç‡ | >55% |
| **é˜¶æ®µ1** | 8-10å¤© | èåˆä¿¡å·å‡†ç¡®ç‡ | >60% |
| **é˜¶æ®µ2** | 2-3å¤© | çœŸå®äº¤æ˜“æ‰§è¡Œ | èƒ½ç¨³å®šè¿è¡Œ24å°æ—¶ |
| **é˜¶æ®µ2** | 2-3å¤© | ç®€å•ç­–ç•¥èƒœç‡ | >50% |
| **é˜¶æ®µ3** | 5-7å¤© | AIæ¨¡å‹å‡†ç¡®ç‡ | >55% |
| **é˜¶æ®µ3** | 5-7å¤© | AIå¢å¼ºåèƒœç‡ | >55% |
| **é˜¶æ®µ4** | 7-10å¤© | æ·±åº¦å­¦ä¹ æå‡ | >é˜¶æ®µ3 +3% |

### **æœ€ç»ˆç›®æ ‡ï¼ˆ2-3å‘¨åï¼‰**

| æŒ‡æ ‡ | ä¿å®ˆç›®æ ‡ | ç†æƒ³ç›®æ ‡ |
|------|---------|---------|
| **èƒœç‡** | 55% | 65% |
| **æ—¥å‡äº¤æ˜“æ•°** | 10-20ç¬” | 20-50ç¬” |
| **å¤æ™®æ¯”ç‡** | 0.5 | 1.0+ |
| **æœ€å¤§å›æ’¤** | <10% | <5% |
| **ç³»ç»Ÿç¨³å®šæ€§** | 99% | 99.9% |
| **äº¤æ˜“å»¶è¿Ÿ** | <500ms | <200ms |

---

## ğŸš« **ä¸¥æ ¼ç¦æ­¢äº‹é¡¹**

### **å¼€å‘è¿‡ç¨‹ä¸­ç»å¯¹ä¸å…è®¸**:
1. âŒ **ä¸å…è®¸ä½¿ç”¨Mockæ•°æ®** - é™¤éç”¨äºå•å…ƒæµ‹è¯•
2. âŒ **ä¸å…è®¸æ„å»º"å‡"ç»„ä»¶** - æ¯ä¸ªåŠŸèƒ½å¿…é¡»çœŸå®å®ç°
3. âŒ **ä¸å…è®¸è·³è¿‡éªŒè¯** - æ¯ä¸ªé˜¶æ®µå¿…é¡»ç”¨çœŸå®æ•°æ®éªŒè¯
4. âŒ **ä¸å…è®¸è¿‡åº¦ä¼˜åŒ–** - åœ¨æ²¡æœ‰çœŸå®åŸºç¡€å‰ä¸è¿½æ±‚å®Œç¾
5. âŒ **ä¸å…è®¸å­¤ç«‹å¼€å‘** - æ‰€æœ‰ç»„ä»¶å¿…é¡»è€ƒè™‘å…¨å±€é›†æˆ

### **å¦‚ä½•åˆ¤æ–­æ˜¯å¦è¿ååŸåˆ™**:
> **é—®è‡ªå·±3ä¸ªé—®é¢˜**:
> 1. è¿™ä¸ªåŠŸèƒ½ç”¨çš„æ˜¯çœŸå®æ•°æ®å—ï¼Ÿ
> 2. è¿™ä¸ªåŠŸèƒ½ç»è¿‡çœŸå®éªŒè¯äº†å—ï¼Ÿ
> 3. è¿™ä¸ªåŠŸèƒ½èƒ½ç‹¬ç«‹è¿è¡Œå¹¶å±•ç¤ºæ•ˆæœå—ï¼Ÿ
> 
> **å¦‚æœä»»ä½•ä¸€ä¸ªç­”æ¡ˆæ˜¯"å¦"ï¼Œç«‹å³åœæ­¢å¹¶ä¿®æ­£**

---

## ğŸ“‹ **å¼€å‘æ£€æŸ¥æ¸…å•**

### **æ¯æ—¥æ£€æŸ¥**
- [ ] ä»Šå¤©å†™çš„ä»£ç ç”¨äº†çœŸå®æ•°æ®å—ï¼Ÿ
- [ ] ä»Šå¤©çš„åŠŸèƒ½ç»è¿‡éªŒè¯äº†å—ï¼Ÿ
- [ ] ä»Šå¤©çš„è¿›å±•èƒ½å±•ç¤ºç»™ç”¨æˆ·çœ‹å—ï¼Ÿ
- [ ] ä»Šå¤©æœ‰æ²¡æœ‰åš"å‡"çš„ä¸œè¥¿ï¼Ÿ

### **æ¯å‘¨æ£€æŸ¥**
- [ ] æœ¬å‘¨çš„ä»£ç èƒ½ç‹¬ç«‹è¿è¡Œå—ï¼Ÿ
- [ ] æœ¬å‘¨çš„åŠŸèƒ½æœ‰çœŸå®æ•ˆæœå—ï¼Ÿ
- [ ] æœ¬å‘¨æœ‰æ²¡æœ‰åç¦»æ ¸å¿ƒç›®æ ‡ï¼Ÿ
- [ ] æœ¬å‘¨çš„è¿›å±•ç¬¦åˆæ—¶é—´è®¡åˆ’å—ï¼Ÿ

### **é˜¶æ®µäº¤ä»˜æ£€æŸ¥**
- [ ] æ‰€æœ‰åŠŸèƒ½éƒ½ç”¨çœŸå®æ•°æ®éªŒè¯äº†å—ï¼Ÿ
- [ ] æ‰€æœ‰ç»„ä»¶éƒ½èƒ½ååŒå·¥ä½œå—ï¼Ÿ
- [ ] ç”¨æˆ·èƒ½çœ‹åˆ°çœŸå®çš„æ•ˆæœå—ï¼Ÿ
- [ ] æœ‰å®Œæ•´çš„æµ‹è¯•å’Œæ–‡æ¡£å—ï¼Ÿ

---

## ğŸ¯ **é¡¹ç›®ç®¡ç†å»ºè®®**

### **æ—¶é—´åˆ†é…åŸåˆ™**
- **60%æ—¶é—´**: æ ¸å¿ƒåŠŸèƒ½å¼€å‘ï¼ˆOFIã€äº¤æ˜“ã€AIï¼‰
- **20%æ—¶é—´**: æµ‹è¯•å’ŒéªŒè¯
- **10%æ—¶é—´**: æ–‡æ¡£å’ŒæŠ¥å‘Š
- **10%æ—¶é—´**: ä¼˜åŒ–å’Œé‡æ„

### **æ¯æ—¥å·¥ä½œæµç¨‹**
1. **æ—©ä¸Šï¼ˆ9:00-12:00ï¼‰**: å¼€å‘æ ¸å¿ƒåŠŸèƒ½
2. **ä¸­åˆï¼ˆ12:00-13:00ï¼‰**: ä¼‘æ¯
3. **ä¸‹åˆï¼ˆ13:00-16:00ï¼‰**: æµ‹è¯•éªŒè¯
4. **ä¸‹åˆï¼ˆ16:00-18:00ï¼‰**: æ–‡æ¡£å’Œæ€»ç»“

### **é—®é¢˜å¤„ç†åŸåˆ™**
- **é‡åˆ°å›°éš¾**: å…ˆå°è¯•æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆ
- **é‡åˆ°Bug**: å…ˆç”¨çœŸå®æ•°æ®å¤ç°
- **é‡åˆ°ç“¶é¢ˆ**: å…ˆå›åˆ°æ ¸å¿ƒç›®æ ‡æ€è€ƒ
- **é‡åˆ°ç–‘æƒ‘**: å…ˆé—®"è¿™ä¸ªçœŸçš„å¿…è¦å—ï¼Ÿ"

---

## ğŸ“š **æŠ€æœ¯æ ˆå»ºè®®**

### **å¿…éœ€çš„**
- **Python**: 3.9+
- **WebSocket**: `websocket-client` æˆ– `python-binance`
- **æ•°æ®å¤„ç†**: `pandas`, `numpy`
- **æœºå™¨å­¦ä¹ **: `scikit-learn`ï¼ˆé˜¶æ®µ3ï¼‰
- **æ·±åº¦å­¦ä¹ **: `PyTorch`ï¼ˆé˜¶æ®µ4ï¼Œå¯é€‰ï¼‰
- **æ•°æ®å­˜å‚¨**: `SQLite` æˆ– `CSV`

### **å¯é€‰çš„**
- **å¯è§†åŒ–**: `matplotlib`, `plotly`
- **ç›‘æ§**: `Prometheus` + `Grafana`
- **æ—¥å¿—**: `loguru`
- **æµ‹è¯•**: `pytest`

---

## ğŸ‰ **é¢„æœŸæˆæœ**

### **3-4å‘¨åï¼Œä½ å°†æ‹¥æœ‰**:
1. âœ… **çœŸå®çš„OFI+CVDè®¡ç®—ç³»ç»Ÿ** - ä½¿ç”¨çœŸå®å¸å®‰æ•°æ®
2. âœ… **å¤šç»´åº¦ä¿¡å·èåˆ** - OFIã€CVDã€èƒŒç¦»æ£€æµ‹
3. âœ… **èƒ½ç›ˆåˆ©çš„äº¤æ˜“ç­–ç•¥** - åœ¨æµ‹è¯•ç½‘éªŒè¯æœ‰æ•ˆ
4. âœ… **æœ‰æ•ˆçš„AIæ¨¡å‹** - æå‡äº¤æ˜“è¡¨ç°
5. âœ… **å®Œæ•´çš„äº¤æ˜“è®°å½•** - çœŸå®çš„PnLæ•°æ®
6. âœ… **å¯éƒ¨ç½²çš„ç³»ç»Ÿ** - éšæ—¶å¯ä»¥ä¸Šçº¿å®ç›˜

### **æ›´é‡è¦çš„æ˜¯**:
- âœ… **æ¯ä¸ªåŠŸèƒ½éƒ½æ˜¯çœŸå®çš„**
- âœ… **æ¯ä¸ªæ•°æ®éƒ½æ˜¯éªŒè¯è¿‡çš„**
- âœ… **æ¯ä¸ªç»“æœéƒ½æ˜¯å¯ä¿¡çš„**
- âœ… **æ•´ä¸ªç³»ç»Ÿæ˜¯å¯æŒç»­çš„**

---

## ğŸš€ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

### **ç«‹å³å¼€å§‹ï¼ˆä»Šå¤©ï¼‰**:
1. [ ] é˜…è¯»å¹¶ç†è§£æœ¬æ–‡æ¡£
2. [ ] æ¸…ç†æ—§ä»£ç ï¼Œåˆ›å»ºæ–°é¡¹ç›®ç›®å½•
3. [ ] å‡†å¤‡å¸å®‰APIå¯†é’¥
4. [ ] åˆ›å»º `README.md` å’Œ `requirements.txt`

### **ç¬¬1å¤©**:
1. [ ] å®ç°å¸å®‰WebSocketå®¢æˆ·ç«¯
2. [ ] èƒ½æ¥æ”¶å¹¶æ‰“å°è®¢å•ç°¿æ•°æ®
3. [ ] éªŒè¯æ•°æ®å®Œæ•´æ€§å’Œå»¶è¿Ÿ

### **ç¬¬2-3å¤©**:
1. [ ] å®ç°çœŸå®çš„OFIè®¡ç®—
2. [ ] æ”¶é›†å¹¶åˆ†æOFIæ•°æ®
3. [ ] éªŒè¯OFIä¿¡å·æœ‰æ•ˆæ€§

### **æ¯å‘¨æ±‡æŠ¥**:
- [ ] å®Œæˆçš„åŠŸèƒ½æ¸…å•
- [ ] çœŸå®æ•°æ®éªŒè¯ç»“æœ
- [ ] é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- [ ] ä¸‹å‘¨è®¡åˆ’

---

## ğŸ“ **é™„å½•ï¼šV12ç»éªŒæ€»ç»“**

### **V12åšå¯¹çš„äº‹**:
1. âœ… å®Œæ•´çš„æ¶æ„è®¾è®¡
2. âœ… ä¸°å¯Œçš„æŠ€æœ¯æ ˆé€‰æ‹©
3. âœ… å¤šæ¬¡è¿­ä»£æµ‹è¯•

### **V12åšé”™çš„äº‹**:
1. âŒ å¤ªå¤š"å‡"ç»„ä»¶
2. âŒ Mockæ•°æ®è¿‡å¤š
3. âŒ ç¼ºä¹çœŸå®éªŒè¯
4. âŒ è¿‡åº¦è¿½æ±‚å®Œç¾

### **V13æ”¹è¿›**:
1. âœ… ä»çœŸå®æ•°æ®å¼€å§‹
2. âœ… æ¯æ­¥éƒ½éªŒè¯
3. âœ… ç®€å•ä½†æœ‰æ•ˆ
4. âœ… å…¨å±€æ€ç»´

---

**æ–‡æ¡£ç‰ˆæœ¬**: V13_Fresh_Start_v1.1  
**åˆ›å»ºæ—¶é—´**: 2025-01-17  
**æœ€åæ›´æ–°**: 2025-10-17 (æ–°å¢CVDåŠŸèƒ½æ¨¡å—)  
**çŠ¶æ€**: å‡†å¤‡å¼€å§‹  

**ä½œè€…å¯„è¯­**: 
> "è¿™æ¬¡ï¼Œæˆ‘ä»¬ä»çœŸå®å¼€å§‹ï¼Œæ¯ä¸€æ­¥éƒ½è¸å®ã€‚ä¸è¿½æ±‚å®Œç¾ï¼Œä½†è¿½æ±‚çœŸå®ã€‚ä¸åš100ä¸ªå‡ç»„ä»¶,åªåš10ä¸ªçœŸç»„ä»¶ã€‚è®©æˆ‘ä»¬ä¸€èµ·æ„å»ºä¸€ä¸ªçœŸæ­£æœ‰æ•ˆçš„OFI+AIäº¤æ˜“ç³»ç»Ÿï¼"

---

## ğŸ¯ **å¿«é€Ÿå¯åŠ¨å‘½ä»¤**

```bash
# 1. åˆ›å»ºæ–°é¡¹ç›®
mkdir v13_ofi_ai_system
cd v13_ofi_ai_system

# 2. åˆå§‹åŒ–
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 3. å®‰è£…ä¾èµ–
pip install pandas numpy scikit-learn python-binance websocket-client

# 4. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p src tests data config docs

# 5. å¼€å§‹ç¬¬ä¸€ä¸ªä»»åŠ¡
touch src/binance_websocket_client.py
code src/binance_websocket_client.py  # æ‰“å¼€ç¼–è¾‘å™¨

# 6. è¿è¡Œç¬¬ä¸€ä¸ªæµ‹è¯•
python src/binance_websocket_client.py
```

**å‡†å¤‡å¥½äº†å—ï¼Ÿè®©æˆ‘ä»¬å¼€å§‹å§ï¼** ğŸš€

