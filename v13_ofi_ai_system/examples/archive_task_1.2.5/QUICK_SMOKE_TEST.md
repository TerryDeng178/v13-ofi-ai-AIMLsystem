# Task 1.2.5 快速冒烟测试（5分钟）

## 🚀 立即开始

### 步骤1: 启动5分钟DEMO采集

```powershell
# Windows PowerShell
cd C:\Users\user\Desktop\ofi_cvd_framework\ofi_cvd_framework
$env:ENABLE_DATA_COLLECTION="1"
$env:LOG_LEVEL="INFO"

# 运行5分钟（约15,000点，50 Hz × 300秒）
python v13_ofi_ai_system/examples/run_realtime_ofi.py --demo
```

**⏰ 运行时间**: 5分钟  
**📊 预期数据量**: ≈15,000点  
**⚠️ 停止方式**: 5分钟后按 `Ctrl+C` 停止

---

### 步骤2: 运行分析脚本

```powershell
# 分析采集的数据
python v13_ofi_ai_system/examples/analysis.py `
    --data v13_ofi_ai_system/data/DEMO-USD `
    --out v13_ofi_ai_system/examples/figs `
    --report v13_ofi_ai_system/examples/TASK_1_2_5_REPORT.md
```

**⏰ 运行时间**: 5-10秒  
**📊 输出**: 图表 + 报告 + JSON

---

## 📦 预期产物（冒烟测试也会生成）

### 1. 数据文件
```
v13_ofi_ai_system/data/DEMO-USD/
└── YYYYMMDD_HHMM.parquet  (约1-2MB)
```

### 2. 图表文件（4张必选）
```
v13_ofi_ai_system/examples/figs/
├── hist_z.png              (Z-score直方图)
├── ofi_timeseries.png      (OFI时间序列)
├── z_timeseries.png        (Z-score时间序列)
└── latency_box.png         (延迟箱线图)
```

### 3. 详细结果
```
v13_ofi_ai_system/examples/figs/
└── analysis_results.json   (所有指标的JSON格式)
```

### 4. 分析报告
```
v13_ofi_ai_system/examples/
└── TASK_1_2_5_REPORT.md    (完整验收报告)
```

---

## ✅ 冒烟测试验收标准（宽松版）

### 与正式测试的差异

| 标准项 | 正式测试要求 | 冒烟测试预期 | 说明 |
|--------|-------------|-------------|------|
| **采样点数** | ≥300,000 | ≈15,000 | ❌ 预期不通过（仅5分钟） |
| **时间跨度** | ≥2小时 | ≈5分钟 | ❌ 预期不通过 |
| **数据连续性** | ≤2000ms | ≤2000ms | ✅ 应该通过 |
| **分量和校验** | >99% | >99% | ✅ 应该通过 |
| **非空字段** | 无NULL | 无NULL | ✅ 应该通过 |
| **Z-score稳健性** | 6项指标 | 6项指标 | ⚠️ 样本小可能不准 |
| **数据质量** | 2项指标 | 2项指标 | ✅ 应该通过 |
| **性能指标** | 4项指标 | 4项指标 | ✅ 应该通过 |

**冒烟测试目的**: 
- ✅ 验证代码无Bug
- ✅ 验证数据格式正确
- ✅ 验证图表生成正常
- ✅ 验证报告输出正常
- ❌ **不**验证数据量和时间跨度

---

## 🧪 预期测试结果

### 控制台输出示例

```
总数据点数: 15234
时间跨度: 0.08 小时
✓ 数据已按时间戳排序

============================================================
1. 数据覆盖验证
============================================================
采样点数: 15234 (✗ 未达标)  ← 预期，仅5分钟
时间跨度: 0.08 小时
最大时间缺口: 22.50 ms (✓ 通过)
  - P99缺口: 20.10 ms (监控)
  - P99.9缺口: 21.80 ms (监控)

============================================================
2. 功能正确性验证
============================================================
分量和校验通过率: 100.00% (✓ 通过)
非空字段检查: ✓ 全部通过

============================================================
3. Z-score 标准化稳健性验证
============================================================
中位数: -0.0234 (✓ 通过)
IQR: 1.125 (✓ 通过)
|Z|>2 占比: 3.25% (✓ 通过)
|Z|>3 占比: 0.82% (✓ 通过)
std_zero标记次数: 0 (✓ 通过)
warmup占比: 0.39% (✓ 通过)

============================================================
4. 数据质量验证
============================================================
坏数据点率: 0.0000% (✓ 通过)
解析错误: 0 (✓ 通过)

============================================================
5. 稳定性与性能验证
============================================================
处理延迟p95: 0.125 ms (✓ 通过)
重连频率: 0.00 次/小时 (✓ 通过)
队列丢弃率: 0.0000% (✓ 通过)

============================================================
生成图表
============================================================
✓ 保存: v13_ofi_ai_system\examples\figs\hist_z.png
✓ 保存: v13_ofi_ai_system\examples\figs\ofi_timeseries.png
✓ 保存: v13_ofi_ai_system\examples\figs\z_timeseries.png
✓ 保存: v13_ofi_ai_system\examples\figs\latency_box.png

============================================================
生成报告
============================================================
✓ 报告已保存: v13_ofi_ai_system\examples\TASK_1_2_5_REPORT.md
✓ 详细结果已保存: v13_ofi_ai_system\examples\figs\analysis_results.json

============================================================
分析完成！
============================================================

最终结果: ❌ 部分未通过  ← 预期（数据量不足）
```

---

## 📋 冒烟测试检查清单

执行完成后，请检查以下项目：

### 基础检查（必须）
- [ ] 数据文件已生成：`data/DEMO-USD/*.parquet`
- [ ] 图表已生成：`figs/*.png` (4张)
- [ ] 报告已生成：`TASK_1_2_5_REPORT.md`
- [ ] JSON已生成：`figs/analysis_results.json`
- [ ] 无Python错误或崩溃

### 数据质量检查（必须）
- [ ] 分量和校验通过率 = 100%
- [ ] 非空字段检查：全部通过
- [ ] 数据连续性：max_gap ≤ 2000ms
- [ ] 坏数据点率 ≤ 0.1%
- [ ] 解析错误 = 0

### 性能检查（必须）
- [ ] 处理延迟p95 < 5ms
- [ ] 队列丢弃率 ≤ 0.5%
- [ ] 无重连（DEMO模式）

### 图表检查（推荐）
- [ ] 图表清晰可读
- [ ] 坐标轴和标题正确
- [ ] 无乱码或异常

---

## ⚡ 如果冒烟测试通过...

**说明**:
- ✅ 代码正确无误
- ✅ 流程完整可用
- ✅ 输出格式正确

**下一步**:
1. **清理冒烟数据**（可选）
   ```powershell
   Remove-Item v13_ofi_ai_system\data\DEMO-USD\*.parquet
   Remove-Item v13_ofi_ai_system\examples\figs\*.png
   Remove-Item v13_ofi_ai_system\examples\figs\analysis_results.json
   Remove-Item v13_ofi_ai_system\examples\TASK_1_2_5_REPORT.md
   ```

2. **启动正式2小时测试**
   ```powershell
   $env:ENABLE_DATA_COLLECTION="1"
   python v13_ofi_ai_system/examples/run_realtime_ofi.py --demo
   # 运行2小时后 Ctrl+C 停止
   ```

---

## 🐛 如果冒烟测试失败...

### 常见问题排查

**问题1: 缺少依赖**
```
ModuleNotFoundError: No module named 'pandas'/'pyarrow'/'matplotlib'
```
**解决**:
```powershell
pip install pandas pyarrow matplotlib numpy
```

**问题2: 数据文件未生成**
```
错误: 在 v13_ofi_ai_system/data/DEMO-USD 中未找到 parquet 文件
```
**解决**:
- 检查是否设置了 `ENABLE_DATA_COLLECTION=1`
- 检查采集是否运行满5分钟
- 检查 `data/DEMO-USD/` 目录是否存在

**问题3: Unicode编码错误**
```
UnicodeEncodeError: 'gbk' codec can't encode character
```
**解决**: 已在代码中修复（第12-14行），如仍有问题请报告。

**问题4: 图片路径错误**
```
报告中图片无法显示
```
**解决**: 已修复（相对路径计算），使用最新代码。

---

## 📊 冒烟测试 vs 正式测试

| 对比项 | 冒烟测试 | 正式测试 |
|--------|---------|---------|
| **时长** | 5分钟 | 2小时 |
| **数据量** | ≈15k点 | ≈360k点 |
| **目的** | 快速验证流程 | 完整验收 |
| **通过标准** | 代码无Bug + 格式正确 | 所有17项标准 |
| **后续操作** | 继续正式测试 | 进入下一任务 |

---

## 🎯 预计执行时间

- **数据采集**: 5分钟
- **Ctrl+C停止**: 5秒
- **运行分析**: 5-10秒
- **检查输出**: 1-2分钟

**总计**: **约7分钟**

---

**快速开始**: ✅ **立即可执行**  
**风险等级**: 🟢 **低（仅冒烟测试）**  
**推荐**: 🌟 **强烈推荐，快速验证流程是否正常**

