# Core Algorithm å½±å­äº¤æ˜“å·¡æ£€ç³»ç»Ÿæµ‹è¯•æŠ¥å‘Š

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

**æµ‹è¯•ç›®æ ‡**: å¯¹"core_algo.py é©±åŠ¨çš„ä¿¡å·æµæ°´çº¿ï¼ˆCollectorâ†’OFI/CVDâ†’Fusion/Divergenceâ†’StrategyModeâ†’PaperTraderï¼‰"è¿›è¡Œå½±å­äº¤æ˜“å·¡æ£€ï¼Œå¹¶æ ¹æ®ç¡¬æ€§é˜ˆå€¼ç»™å‡º Go/No-Go ç»“è®ºã€‚

**æµ‹è¯•ç¯å¢ƒ**: Windows 10, Python 3.x, çº¯æ ‡å‡†åº“å®ç°
**æµ‹è¯•æ—¶é—´**: 2024-01-15
**æµ‹è¯•èŒƒå›´**: 5ä¸ªæ ¸å¿ƒå·¡æ£€è„šæœ¬ + ç»Ÿä¸€åˆ¤å®šç³»ç»Ÿ

---

## ğŸ¯ æµ‹è¯•èŒƒå›´ä¸ç›®æ ‡

### æ ¸å¿ƒæµ‹è¯•ç»„ä»¶
1. **Z-Scoreå¥åº·æ£€æŸ¥** (`z_healthcheck.py`)
2. **ä¿¡å·ä¸€è‡´æ€§æ£€æŸ¥** (`signal_consistency.py`)
3. **å­˜å‚¨å¥åº·å·¡æ£€** (`storage_liveness.py`)
4. **æ»åä¸é˜Ÿåˆ—å¥åº·æ£€æŸ¥** (`latency_and_queue.py`)
5. **ç»Ÿä¸€Go/No-Goåˆ¤å®š** (`shadow_go_nogo.py`)

### éªŒæ”¶æ ‡å‡†
- âœ… ä»…ä½¿ç”¨Pythonæ ‡å‡†åº“ï¼Œæ— ç¬¬ä¸‰æ–¹ä¾èµ–
- âœ… ä¸ä¿®æ”¹æ ¸å¿ƒä¸šåŠ¡ä»£ç ä¸é…ç½®
- âœ… è¯»å–ç°æœ‰è¾“å‡ºæ–‡ä»¶è¿›è¡Œå·¡æ£€
- âœ… æ— æ•°æ®æ—¶æ˜ç¡®BLOCKEDçŠ¶æ€
- âœ… æŒ‰ç¡¬æ€§é˜ˆå€¼ç»™å‡ºGo/No-Goåˆ¤å®š

---

## ğŸ§ª æµ‹è¯•æ‰§è¡Œè¯¦æƒ…

### 1. Z-Scoreå¥åº·æ£€æŸ¥æµ‹è¯•

**è„šæœ¬**: `tools/z_healthcheck.py`
**æµ‹è¯•æ•°æ®**: 20ä¸ªæ¨¡æ‹Ÿä¿¡å·è®°å½•
**æµ‹è¯•ç»“æœ**:

```
=== Z-Score Health Check ===
Loaded 20 signals from recent files
P(|z_ofi|>2): 40.00%
P(|z_cvd|>2): 0.00%
Weak ratio (1.0â‰¤|score|<1.8): 35.00%
Strong ratio (|score|â‰¥1.8): 35.00%
Confirm ratio: 70.00%
Missing z_ofi: 0.00%
Missing z_cvd: 0.00%
Invalid scores: 0.00%
Z-health check completed successfully
```

**é˜ˆå€¼è¯„ä¼°**:
- âŒ P(|z_ofi|>2): 40.00% (è¶…å‡º3-12%èŒƒå›´)
- âŒ P(|z_cvd|>2): 0.00% (ä½äº3%ä¸‹é™)
- âŒ Strong ratio: 35.00% (è¶…å‡º0.8-3.5%èŒƒå›´)
- âœ… Confirm ratio: 70.00% (å¤§äº0%)

**åŠŸèƒ½éªŒè¯**:
- âœ… çº¯Pythonç™¾åˆ†ä½å‡½æ•°å®ç°
- âœ… æœ‰é™æ•°æ£€æŸ¥åŠŸèƒ½
- âœ… ç¼ºå¤±å€¼ç»Ÿè®¡
- âœ… æ–‡ä»¶è¯»å–ä¸è§£æ

### 2. ä¿¡å·ä¸€è‡´æ€§æ£€æŸ¥æµ‹è¯•

**è„šæœ¬**: `tools/signal_consistency.py`
**æµ‹è¯•ç»“æœ**:

```
=== Signal Consistency Check ===
Loaded 20 signals from recent files
Divergence vs Fusion conflict: 0.00%
Strong signal 5m directional accuracy: N/A
Confirm after threshold rate: 100.00%
Total signals: 20
Divergence signals: 14
Strong signals (|score|â‰¥1.8): 7
Threshold signals (|score|â‰¥1.0, non-gating): 14
Signal consistency check completed successfully
```

**é˜ˆå€¼è¯„ä¼°**:
- âœ… Divergence vs Fusion conflict: 0.00% (< 2%)
- âœ… Confirm after threshold rate: 100.00% (ä¼˜ç§€)
- â„¹ï¸ Strong signal 5m directional accuracy: N/A (éœ€è¦ä»·æ ¼æ•°æ®)

**åŠŸèƒ½éªŒè¯**:
- âœ… èƒŒç¦»ä¸èåˆå†²çªæ£€æµ‹
- âœ… é˜ˆå€¼åç¡®è®¤ç‡è®¡ç®—
- âœ… ä¿¡å·åˆ†ç±»ç»Ÿè®¡
- âœ… æ—¶é—´åºåˆ—åˆ†æ

### 3. å­˜å‚¨å¥åº·å·¡æ£€æµ‹è¯•

**è„šæœ¬**: `tools/storage_liveness.py`
**æµ‹è¯•ç»“æœ**:

```
=== Storage Liveness Check ===
Ready signals files: 2
Spool files: 0
Minutes covered (last 10min): 1
Ready rotation OK: False
Gate stats entries: 1
Gate stats heartbeat OK: False
Overall status: ALERT
Storage liveness check completed with alerts
```

**é˜ˆå€¼è¯„ä¼°**:
- âŒ Ready rotation OK: False (éœ€è¦æ¯åˆ†é’Ÿéƒ½æœ‰æ–°åˆ†ç‰‡)
- âŒ Gate stats heartbeat OK: False (éœ€è¦â‰¤60så¿ƒè·³)
- âœ… Spool stagnant files: 0 (æ— æ»ç•™æ–‡ä»¶)

**åŠŸèƒ½éªŒè¯**:
- âœ… æ–‡ä»¶åˆ†ç‰‡æ£€æŸ¥
- âœ… å¿ƒè·³ç›‘æ§
- âœ… æ»ç•™æ–‡ä»¶æ£€æµ‹
- âœ… ç»¼åˆçŠ¶æ€è¯„ä¼°

### 4. æ»åä¸é˜Ÿåˆ—å¥åº·æ£€æŸ¥æµ‹è¯•

**è„šæœ¬**: `tools/latency_and_queue.py`
**æµ‹è¯•ç»“æœ**:

```
=== Latency and Queue Health Check ===
Loaded 20 signals from recent files
Event lag P50: 56363815975.0ms
Event lag P95: 56364328975.0ms
JsonlSink qsize: None
JsonlSink open files: None
JsonlSink dropped: None
Lag P95 OK (â‰¤120ms): False
Dropped OK (==0): True
Latency and queue health check completed with issues
```

**é˜ˆå€¼è¯„ä¼°**:
- âŒ Lag P95: 56364328975.0ms (è¿œè¶…120msé˜ˆå€¼)
- âœ… Dropped OK: True (æ— ä¸¢åŒ…)

**åŠŸèƒ½éªŒè¯**:
- âœ… äº‹ä»¶æ»åè®¡ç®—
- âœ… ç™¾åˆ†ä½ç»Ÿè®¡
- âœ… é˜Ÿåˆ—æŒ‡æ ‡æå–
- âœ… é˜ˆå€¼æ£€æŸ¥

### 5. ç»Ÿä¸€Go/No-Goåˆ¤å®šæµ‹è¯•

**è„šæœ¬**: `tools/shadow_go_nogo.py`
**æµ‹è¯•ç»“æœ**:

```
=== Shadow Trading Go/No-Go Decision ===

--- Running z_healthcheck.py ---
[Z-Healthç»“æœå¦‚ä¸Š]

--- Running signal_consistency.py ---
[Consistencyç»“æœå¦‚ä¸Š]

--- Running storage_liveness.py ---
[Storageç»“æœå¦‚ä¸Š]

--- Running latency_and_queue.py ---
[Latencyç»“æœå¦‚ä¸Š]

=== Summary ===
z_health: {'p_abs_gt2_ofi': 40.0, 'p_abs_gt2_cvd': 0.0, 'weak_ratio': 35.0, 'strong_ratio': 35.0, 'confirm_ratio': 70.0}
consistency: {'div_vs_fusion_conflict': 0.0, 'confirm_after_threshold_rate': 100.0, 'strong_5m_acc': 'N/A'}
latency: {'lag_p50_ms': 56363815975.0, 'lag_p95_ms': 56364328975.0}
storage: {'minutes_covered': 1, 'ready_rotation_ok': False, 'heartbeat_ok': False}
decision: NO-GO

=== Threshold Check Results ===
p_abs_gt2_ofi_ok: FAIL
p_abs_gt2_cvd_ok: FAIL
strong_ratio_ok: FAIL
confirm_ratio_ok: PASS
div_vs_fusion_conflict_ok: PASS
lag_p95_ok: FAIL
ready_rotation_ok: FAIL
gate_stats_heartbeat_ok: FAIL

Summary written to artifacts\shadow_summary.yaml

DECISION: NO-GO
Failed thresholds: p_abs_gt2_ofi_ok, p_abs_gt2_cvd_ok, strong_ratio_ok, lag_p95_ok, ready_rotation_ok, gate_stats_heartbeat_ok
```

---

## ğŸ“Š æµ‹è¯•æ•°æ®åˆ†æ

### ç¡¬æ€§é˜ˆå€¼è¯„ä¼°çŸ©é˜µ

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡åç§° | é˜ˆå€¼è¦æ±‚ | å®é™…å€¼ | çŠ¶æ€ | å½±å“ |
|---------|---------|---------|--------|------|------|
| **æ•°æ®è´¨é‡** | P(\|z_ofi\|>2) | 3-12% | 40.00% | âŒ FAIL | ä¸¥é‡è¶…æ ‡ |
| | P(\|z_cvd\|>2) | 3-12% | 0.00% | âŒ FAIL | ä½äºä¸‹é™ |
| | Strong ratio | 0.8-3.5% | 35.00% | âŒ FAIL | ä¸¥é‡è¶…æ ‡ |
| | Confirm ratio | >0% | 70.00% | âœ… PASS | ä¼˜ç§€ |
| **ä¸€è‡´æ€§** | Div vs Fusion conflict | <2% | 0.00% | âœ… PASS | ä¼˜ç§€ |
| | Strong 5m accuracy | â‰¥52% | N/A | â„¹ï¸ N/A | éœ€ä»·æ ¼æ•°æ® |
| **æ€§èƒ½** | Lag P95 | â‰¤120ms | 56364328975ms | âŒ FAIL | ä¸¥é‡è¶…æ ‡ |
| | JsonlSink dropped | ==0 | 0 | âœ… PASS | ä¼˜ç§€ |
| **å­˜å‚¨** | Ready rotation | æ¯åˆ†é’Ÿåˆ†ç‰‡ | False | âŒ FAIL | åˆ†ç‰‡ä¸è¶³ |
| | Gate stats heartbeat | â‰¤60s | False | âŒ FAIL | å¿ƒè·³è¶…æ—¶ |

### å…³é”®é—®é¢˜åˆ†æ

#### ğŸ”´ ä¸¥é‡é—®é¢˜
1. **Z-Scoreåˆ†å¸ƒå¼‚å¸¸**: OFI Z-scoreè¶…å‡ºæ­£å¸¸èŒƒå›´ï¼ŒCVD Z-scoreè¿‡ä½
2. **å¼ºä¿¡å·æ¯”ä¾‹è¿‡é«˜**: 35%çš„å¼ºä¿¡å·æ¯”ä¾‹è¿œè¶…æ­£å¸¸3.5%ä¸Šé™
3. **äº‹ä»¶æ»åä¸¥é‡**: P95æ»åè¶…è¿‡56äº¿æ¯«ç§’ï¼Œè¿œè¶…120msé˜ˆå€¼
4. **å­˜å‚¨åˆ†ç‰‡ä¸è¶³**: 10åˆ†é’Ÿå†…åªæœ‰1åˆ†é’Ÿæœ‰åˆ†ç‰‡ï¼Œè¿œä½äºè¦æ±‚

#### ğŸŸ¡ ä¸­ç­‰é—®é¢˜
1. **å¿ƒè·³ç›‘æ§å¤±æ•ˆ**: Gate statså¿ƒè·³è¶…æ—¶
2. **é˜Ÿåˆ—æŒ‡æ ‡ç¼ºå¤±**: æ— æ³•è·å–JsonlSinké˜Ÿåˆ—çŠ¶æ€

#### ğŸŸ¢ æ­£å¸¸æŒ‡æ ‡
1. **ä¿¡å·ä¸€è‡´æ€§**: èƒŒç¦»ä¸èåˆæ— å†²çª
2. **ç¡®è®¤ç‡**: é˜ˆå€¼åç¡®è®¤ç‡100%
3. **æ— ä¸¢åŒ…**: JsonlSinkæ— ä¸¢åŒ…è®°å½•

---

## ğŸ” åŠŸèƒ½éªŒè¯ç»“æœ

### æ ¸å¿ƒåŠŸèƒ½éªŒè¯

| åŠŸèƒ½æ¨¡å— | éªŒè¯é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| **æ–‡ä»¶è¯»å–** | JSONLè§£æ | âœ… PASS | æ­£ç¡®è§£æä¿¡å·æ•°æ® |
| | ç›®å½•æ‰«æ | âœ… PASS | æ­£ç¡®æ‰«ææ–‡ä»¶ç»“æ„ |
| | æ—¶é—´è¿‡æ»¤ | âœ… PASS | æ­£ç¡®è¿‡æ»¤æœ€è¿‘æ–‡ä»¶ |
| **æ•°æ®è®¡ç®—** | ç™¾åˆ†ä½å‡½æ•° | âœ… PASS | çº¯Pythonå®ç°æ­£ç¡® |
| | Z-scoreç»Ÿè®¡ | âœ… PASS | æ­£ç¡®è®¡ç®—åˆ†å¸ƒ |
| | ä¸€è‡´æ€§åˆ†æ | âœ… PASS | æ­£ç¡®æ£€æµ‹å†²çª |
| **é˜ˆå€¼åˆ¤å®š** | ç¡¬æ€§é˜ˆå€¼ | âœ… PASS | æ­£ç¡®åº”ç”¨æ‰€æœ‰é˜ˆå€¼ |
| | é˜»æ–­æ¡ä»¶ | âœ… PASS | æ­£ç¡®æ£€æµ‹é˜»æ–­çŠ¶æ€ |
| | ç»¼åˆåˆ¤å®š | âœ… PASS | æ­£ç¡®ç»™å‡ºGo/No-Go |

### é”™è¯¯å¤„ç†éªŒè¯

| é”™è¯¯ç±»å‹ | å¤„ç†æ–¹å¼ | çŠ¶æ€ | è¯´æ˜ |
|---------|---------|------|------|
| **æ–‡ä»¶ä¸å­˜åœ¨** | BLOCKEDçŠ¶æ€ | âœ… PASS | æ­£ç¡®æ£€æµ‹å¹¶é€€å‡º |
| **æ•°æ®è§£æé”™è¯¯** | è·³è¿‡é”™è¯¯è¡Œ | âœ… PASS | å¥å£®å¤„ç†JSONé”™è¯¯ |
| **ç¼–ç é—®é¢˜** | UTF-8å¤„ç† | âœ… PASS | æ­£ç¡®å¤„ç†ç¼–ç  |
| **è¶…æ—¶å¤„ç†** | 30sè¶…æ—¶ | âœ… PASS | é˜²æ­¢è„šæœ¬å¡æ­» |

---

## ğŸ“ˆ æ€§èƒ½è¯„ä¼°

### æ‰§è¡Œæ€§èƒ½
- **æ€»æ‰§è¡Œæ—¶é—´**: <5ç§’ (4ä¸ªè„šæœ¬ + ä¸»åˆ¤å®š)
- **å†…å­˜ä½¿ç”¨**: ä½ (çº¯Pythonæ ‡å‡†åº“)
- **CPUä½¿ç”¨**: ä½ (ç®€å•è®¡ç®—ä»»åŠ¡)
- **I/Oæ•ˆç‡**: é«˜ (æ‰¹é‡æ–‡ä»¶è¯»å–)

### å¯æ‰©å±•æ€§
- **æ•°æ®é‡æ”¯æŒ**: æ”¯æŒå¤§é‡å†å²æ•°æ® (é™åˆ¶120ä¸ªåˆ†ç‰‡)
- **å¤šç¬¦å·æ”¯æŒ**: æ”¯æŒå¤šäº¤æ˜“å¯¹åŒæ—¶ç›‘æ§
- **æ—¶é—´çª—å£**: å¯é…ç½®ç›‘æ§æ—¶é—´çª—å£

---

## ğŸ¯ æµ‹è¯•ç»“è®º

### æ€»ä½“è¯„ä¼°: âš ï¸ ç³»ç»Ÿéœ€è¦ä¼˜åŒ–

**å½“å‰çŠ¶æ€**: NO-GO
**ä¸»è¦é—®é¢˜**: 6ä¸ªå…³é”®é˜ˆå€¼æœªè¾¾æ ‡
**å»ºè®®è¡ŒåŠ¨**: éœ€è¦ç³»ç»Ÿè°ƒä¼˜å’Œé…ç½®è°ƒæ•´

### å…·ä½“å»ºè®®

#### ğŸ”´ ç´§æ€¥ä¿®å¤
1. **è°ƒæ•´Z-Scoreé˜ˆå€¼**: æ£€æŸ¥OFI/CVDè®¡ç®—å™¨é…ç½®
2. **ä¼˜åŒ–ä¿¡å·å¼ºåº¦**: è°ƒæ•´èåˆæƒé‡å’Œé˜ˆå€¼
3. **ä¿®å¤äº‹ä»¶æ»å**: æ£€æŸ¥æ—¶é—´æˆ³å¤„ç†é€»è¾‘
4. **å¢åŠ å­˜å‚¨åˆ†ç‰‡**: ç¡®ä¿æ¯åˆ†é’Ÿéƒ½æœ‰æ–°åˆ†ç‰‡

#### ğŸŸ¡ ä¼˜åŒ–å»ºè®®
1. **å¢å¼ºå¿ƒè·³ç›‘æ§**: ç¡®ä¿gate_statså®šæœŸæ›´æ–°
2. **æ·»åŠ ä»·æ ¼æ•°æ®**: æ”¯æŒæ–¹å‘å‡†ç¡®ç‡è®¡ç®—
3. **å®Œå–„é˜Ÿåˆ—ç›‘æ§**: å¢å¼ºJsonlSinkçŠ¶æ€ç›‘æ§

#### ğŸŸ¢ ä¿æŒä¼˜åŠ¿
1. **ä¿¡å·ä¸€è‡´æ€§**: èƒŒç¦»æ£€æµ‹å·¥ä½œæ­£å¸¸
2. **ç¡®è®¤æœºåˆ¶**: é˜ˆå€¼åç¡®è®¤ç‡ä¼˜ç§€
3. **æ— ä¸¢åŒ…**: é˜Ÿåˆ—å¤„ç†ç¨³å®š

---

## ğŸ“‹ æµ‹è¯•ç¯å¢ƒä¿¡æ¯

### ç³»ç»Ÿç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Windows 10
- **Pythonç‰ˆæœ¬**: 3.x
- **ä¾èµ–åº“**: ä»…æ ‡å‡†åº“
- **æµ‹è¯•æ•°æ®**: 20ä¸ªæ¨¡æ‹Ÿä¿¡å·è®°å½•

### æ–‡ä»¶ç»“æ„
```
v13_ofi_ai_system/
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ z_healthcheck.py
â”‚   â”œâ”€â”€ signal_consistency.py
â”‚   â”œâ”€â”€ storage_liveness.py
â”‚   â”œâ”€â”€ latency_and_queue.py
â”‚   â””â”€â”€ shadow_go_nogo.py
â”œâ”€â”€ runtime/ready/signal/BTCUSDT/
â”‚   â”œâ”€â”€ signals_20240115_1030.jsonl
â”‚   â””â”€â”€ signals_20240115_1040.jsonl
â””â”€â”€ artifacts/
    â”œâ”€â”€ gate_stats.jsonl
    â””â”€â”€ shadow_summary.yaml
```

---

## ğŸ”„ åç»­æµ‹è¯•è®¡åˆ’

### çŸ­æœŸæµ‹è¯• (1-2å‘¨)
1. **é…ç½®è°ƒä¼˜æµ‹è¯•**: è°ƒæ•´Z-Scoreå’Œä¿¡å·å¼ºåº¦é˜ˆå€¼
2. **æ—¶é—´æˆ³ä¿®å¤æµ‹è¯•**: ä¿®å¤äº‹ä»¶æ»åé—®é¢˜
3. **å­˜å‚¨ä¼˜åŒ–æµ‹è¯•**: ç¡®ä¿åˆ†ç‰‡æ­£å¸¸ç”Ÿæˆ

### ä¸­æœŸæµ‹è¯• (1ä¸ªæœˆ)
1. **ç”Ÿäº§æ•°æ®æµ‹è¯•**: ä½¿ç”¨çœŸå®äº¤æ˜“æ•°æ®
2. **é•¿æœŸç¨³å®šæ€§æµ‹è¯•**: 24å°æ—¶è¿ç»­è¿è¡Œ
3. **å¤šç¬¦å·æµ‹è¯•**: åŒæ—¶ç›‘æ§å¤šä¸ªäº¤æ˜“å¯¹

### é•¿æœŸæµ‹è¯• (3ä¸ªæœˆ)
1. **æ€§èƒ½ä¼˜åŒ–æµ‹è¯•**: å¤§æ•°æ®é‡å¤„ç†
2. **ç›‘æ§é›†æˆæµ‹è¯•**: ä¸ç°æœ‰ç›‘æ§ç³»ç»Ÿé›†æˆ
3. **è‡ªåŠ¨åŒ–æµ‹è¯•**: CI/CDæµæ°´çº¿é›†æˆ

---

## ğŸ“ è”ç³»ä¿¡æ¯

**æµ‹è¯•å·¥ç¨‹å¸ˆ**: AI Assistant
**æµ‹è¯•æ—¥æœŸ**: 2024-01-15
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡è¯„ä¼°**: ç³»ç»Ÿè°ƒä¼˜å

---

*æœ¬æŠ¥å‘ŠåŸºäºcore_algo.pyé©±åŠ¨çš„ä¿¡å·æµæ°´çº¿å½±å­äº¤æ˜“å·¡æ£€ç³»ç»Ÿæµ‹è¯•ç»“æœç”Ÿæˆï¼Œç”¨äºè¯„ä¼°ç³»ç»Ÿå½“å‰çŠ¶æ€å’Œæä¾›ä¼˜åŒ–å»ºè®®ã€‚*
